{
  
    
        "post0": {
            "title": "Basic portfolio optimization",
            "content": "# uncomment to install in colab # !pip3 install fastquant . Some Basic Ideas . Stock or Share is a unit of ownership in a company. When you invest in the stock market, (stock market is basically a place for buying or selling stocks) there are 2 main ways of earning: . Dividend - This is an amount paid to you by a company for your investment. | Stock Trading - The profit that you make for buying/selling stocks. | Portfolio - A combination of assets of an individual / investor. | . Fundamentally, you can earn money by buying some stocks, in the hope that it&#39;s price will increase in the future. . There are actually clever ways on how to earn even if you predict that a stock price will decline, but that&#39;s outside the scope of this lecture. . So in this lecture, we&#39;ll oversimplify and what we want is to buy a stock cheap, and sell it when its price has increased because that way we will make a profit. Otherwise we will incur a loss, if we decided to sell a stock at a cheaper price. . Modern Portfolio Theory (Markowitz Model) . As mentioned above, investing in the stock market can result in either profit or loss. . In a nutshell, Modern Portfolio Theory is a way of maximizing return for a given risk. We will define what return and risk means shortly. . Let&#39;s understand this by using an example. . Suppose you wanted to invest in the stock market. After completing your research, you decided to invest in the following companies: . MEG | MAXS | JFC | ALI | . We will download the data for this using a python library called fastquant. It was actually developed by a fellow Filipino Data Scientist. It aims to democratize data-driven investments for everyone. . NOTE The model we&#39;ll be using relies on the assumption that returns are normally distributed. Therefore, it helps if we have large number of data points. . import pandas as pd import numpy as np import matplotlib.pyplot as plt import warnings import scipy.optimize as optimization from fastquant import get_stock_data warnings.filterwarnings(&#39;ignore&#39;) %matplotlib inline . stocks = [&#39;MEG&#39;, &#39;MAXS&#39;, &#39;JFC&#39;, &#39;ALI&#39;] datas = [] for i in stocks: df = get_stock_data(i, &quot;2017-01-01&quot;, &quot;2020-01-01&quot;) df.columns = [&#39;DATE&#39;,i,&#39;Volume&#39;] df = df[[&#39;DATE&#39;,i]] datas.append(df) datas1 = pd.merge(datas[0],datas[1],on=[&#39;DATE&#39;]) datas2 = pd.merge(datas[2],datas[3],on=[&#39;DATE&#39;]) # datas3 = pd.merge(datas[4],datas[5],on=[&#39;DATE&#39;]) # datas4 = pd.merge(datas1,datas2,on=[&#39;DATE&#39;]) data = pd.merge(datas1,datas2,on=[&#39;DATE&#39;]) data.index = data[&#39;DATE&#39;] data.drop(&#39;DATE&#39;,axis=1,inplace=True) . Reading cached file found: MEG_2017-01-01_2020-01-01.csv Reading cached file found: MAXS_2017-01-01_2020-01-01.csv Reading cached file found: JFC_2017-01-01_2020-01-01.csv Reading cached file found: ALI_2017-01-01_2020-01-01.csv . The table below shows the first 5 entries in our dataset. The values here are closing prices. A closing price is a price of a stock at the end of a given trading day. . data.head() . MEG MAXS JFC ALI . DATE . 2017-01-03 3.54 | 25.5 | 200.0 | 32.00 | . 2017-01-04 3.67 | 26.7 | 206.0 | 33.30 | . 2017-01-05 3.72 | 27.3 | 214.0 | 34.15 | . 2017-01-06 3.75 | 28.0 | 213.0 | 34.50 | . 2017-01-09 3.75 | 27.6 | 215.0 | 33.95 | . Now, let&#39;s ask ourselves. Why don&#39;t we invest in a single company, instead of investing in multiple companies? . Modern Portfolio Theory tells us that we can minimize our loss thru diversification. Let&#39;s understand this with an example. . Suppose you decided to invest on January 2017. For illustraton purposes, let&#39;s consider the period January 2017 - May 2018. . Case 1: You invested solely on MAXS | Case 2: You decided to invest 50% to MAXS and the other 50% to JFC | . If you decided to go with case 1, it would be clear that you could immediately lose some money (as the chart shows a decreasing trend). If you instead decided to go with Case 2, your loss could have been mitigated since the price for JFC is increasing during that period. . Of course you could argue that &quot;why not invest all of my money in JFC&quot;, well my counter argument to that would be, when JFC is experiencing a decline in it&#39;s price, there would be some other company that&#39;s actually experiencing an increase in it&#39;s price. . Key Takeaway . Invest in multiple stocks as much as possible, to minimize your loss. (Technically uncorrelated or negatively correlated) | . data[&#39;MAXS&#39;].plot(figsize=(12,5),legend=True) . &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f241afffe48&gt; . data[&#39;JFC&#39;].plot(figsize=(12,5),legend=True,color=&#39;r&#39;) . &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f2418eb37f0&gt; . Now, let&#39;s define what a return is. Intuitively, we can define return as : . The stock price today minus the stock price yesterday. Divide the difference by the stock price yesterday . More formally, . The return $R_{t,t+1}$ from time $t$ to time ${t+1}$ is given by: . $$ R_{t,t+1} = frac{P_{t+1}-P_{t}}{P_{t}} $$ . where $P_i$ is the price of the stock for a given time point. . returns = data.pct_change() returns . MEG MAXS JFC ALI . DATE . 2017-01-03 NaN | NaN | NaN | NaN | . 2017-01-04 0.036723 | 0.047059 | 0.030000 | 0.040625 | . 2017-01-05 0.013624 | 0.022472 | 0.038835 | 0.025526 | . 2017-01-06 0.008065 | 0.025641 | -0.004673 | 0.010249 | . 2017-01-09 0.000000 | -0.014286 | 0.009390 | -0.015942 | . ... ... | ... | ... | ... | . 2019-12-19 0.007371 | 0.008333 | -0.040000 | -0.007650 | . 2019-12-20 -0.024390 | 0.000000 | -0.013889 | 0.013216 | . 2019-12-23 0.007500 | 0.001653 | 0.032864 | 0.027174 | . 2019-12-26 0.014888 | -0.011551 | -0.017273 | -0.017989 | . 2019-12-27 -0.019560 | 0.035058 | -0.000925 | -0.019397 | . 725 rows × 4 columns . The mean of the returns is called the Expected Return. . Similarly, the Risk or Volatility is the standard deviation of the returns. . (This is different from the expected return and volatility of a portfolio, this is for a single stock) . returns.mean() . MEG 0.000370 MAXS -0.000830 JFC 0.000258 ALI 0.000626 dtype: float64 . returns.std() . MEG 0.019875 MAXS 0.018216 JFC 0.017439 ALI 0.016768 dtype: float64 . We&#39;ll only plot MAXS and MEG to emphasize that the return for MEG is more volatile. . returns[[&#39;MAXS&#39;,&#39;MEG&#39;]].plot(figsize=(12,5)) . &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f24189f4dd8&gt; . Expected Return and Risk of a Portfolio . Suppose your portfolio consists of returns $R_1, R_2, R_3, ... ,R_n$. Then, the expected return of a portfolio is given by: . $E(R) = w_1E(R_1) + w_2E(R_2) + w_3E(R_3) + ... + w_nE(R_n) $ . where $w_i$ is the $i$th component of an $n-dimensional$ vector, and $ Sigma w_i = 1.$ . weights = np.random.random(len(stocks)) weights /= np.sum(weights) weights . array([0.43575183, 0.25166811, 0.12249706, 0.190083 ]) . returns.mean() . MEG 0.000370 MAXS -0.000830 JFC 0.000258 ALI 0.000626 dtype: float64 . def calculate_portfolio_return(returns, weights): portfolio_return = np.sum(returns.mean()*weights)*252 print(&quot;Expected Portfolio Return:&quot;, portfolio_return) . calculate_portfolio_return(returns,weights) . Expected Portfolio Return: 0.025927802317915017 . If you had a course in Probability, you might recall that expectation of a random variable is linear while the variance is not. That&#39;s the same argument why the formula for the variance of a portfolio is quite more complicated. . $Var(R) = bf{w^{T}} Sigma textbf{w}$ . where $ Sigma$ is the covariance matrix of $R_i$ . returns.cov() . MEG MAXS JFC ALI . MEG 0.000395 | 0.000051 | 0.000066 | 0.000113 | . MAXS 0.000051 | 0.000332 | 0.000019 | 0.000046 | . JFC 0.000066 | 0.000019 | 0.000304 | 0.000082 | . ALI 0.000113 | 0.000046 | 0.000082 | 0.000281 | . np.sqrt(returns.cov()) . MEG MAXS JFC ALI . MEG 0.019875 | 0.007175 | 0.008150 | 0.010636 | . MAXS 0.007175 | 0.018216 | 0.004331 | 0.006803 | . JFC 0.008150 | 0.004331 | 0.017439 | 0.009034 | . ALI 0.010636 | 0.006803 | 0.009034 | 0.016768 | . returns.std() . MEG 0.019875 MAXS 0.018216 JFC 0.017439 ALI 0.016768 dtype: float64 . def calculate_portfolio_risk(returns, weights): portfolio_variance = np.sqrt(np.dot(weights.T, np.dot(returns.cov()*252,weights))) print(&quot;Expected Risk:&quot;, portfolio_variance) . calculate_portfolio_risk(returns,weights) . Expected Risk: 0.19906556027268363 . Sharpe Ratio . Remember, what we want is to find the best possible weight vector $ bf{w}$ that would give us the best possible return, with a minimal risk. Therefore, we will introduce a new metric called the sharpe ratio. It&#39;s simply equal to . $$S.R. = frac{E(R) - R_f}{ sqrt{Var(R)}}$$ . where $R_f$ is the risk free return. Since we&#39;re only limiting ourselves to risky assets (stocks) therefore, the formula becomes . $$S.R. = frac{E(R) - 0}{ sqrt{Var(R)}} = frac{E(R)}{ sqrt{Var(R)}}$$ . def generate_portfolios(weights, returns): preturns = [] pvariances = [] for i in range(10000): weights = np.random.random(len(stocks)) weights/=np.sum(weights) preturns.append(np.sum(returns.mean()*weights)*252) pvariances.append(np.sqrt(np.dot(weights.T,np.dot(returns.cov()*252,weights)))) preturns = np.array(preturns) pvariances = np.array(pvariances) return preturns,pvariances def plot_portfolios(returns, variances): plt.figure(figsize=(10,6)) plt.scatter(variances,returns,c=returns/variances,marker=&#39;o&#39;) plt.grid(True) plt.xlabel(&#39;Expected Volatility&#39;) plt.ylabel(&#39;Expected Return&#39;) plt.colorbar(label=&#39;Sharpe Ratio&#39;) plt.show() . preturns, pvariances = generate_portfolios(weights,returns) . Monte - Carlo Simulation . Here, we simulated 10,000 possible weight allocations, and computed their respective expected return, risk and sharpe ratio. . plot_portfolios(preturns, pvariances) . Finding the Optimal Weights . At a high level, we would want to run an optimization algorithm that would . $$maximize frac{E(R)-R_f}{ sqrt{Var(R)}}$$ . $$s.t. forall w_i, w_i geq0 and Sigma w_i=1$$ . Full details of the mathematics behind this can be found on resources. . def statistics(weights, returns): portfolio_return=np.sum(returns.mean()*weights)*252 portfolio_volatility=np.sqrt(np.dot(weights.T,np.dot(returns.cov()*252,weights))) return np.array([portfolio_return,portfolio_volatility,portfolio_return/portfolio_volatility]) def min_func_sharpe(weights,returns): return -statistics(weights,returns)[2] def optimize_portfolio(weights,returns): constraints = ({&#39;type&#39;:&#39;eq&#39;,&#39;fun&#39;: lambda x: np.sum(x)-1}) bounds = tuple((0,1) for x in range(len(stocks))) optimum=optimization.minimize(fun=min_func_sharpe,x0=weights,args=returns,method=&#39;SLSQP&#39;,bounds=bounds,constraints=constraints) return optimum def print_optimal_portfolio(optimum, returns): print(&quot;Optimal weights:&quot;, optimum[&#39;x&#39;].round(3)) print(&quot;Expected return, volatility and Sharpe ratio:&quot;, statistics(optimum[&#39;x&#39;].round(3),returns)) def show_optimal_portfolio(optimum, returns, preturns, pvariances): plt.figure(figsize=(10,6)) plt.scatter(pvariances,preturns,c=preturns/pvariances,marker=&#39;o&#39;) plt.grid(True) plt.xlabel(&#39;Expected Volatility&#39;) plt.ylabel(&#39;Expected Return&#39;) plt.colorbar(label=&#39;Sharpe Ratio&#39;) plt.plot(statistics(optimum[&#39;x&#39;],returns)[1],statistics(optimum[&#39;x&#39;],returns)[0],&#39;g*&#39;,markersize=20.0) plt.show() . optimum=optimize_portfolio(weights,returns) print_optimal_portfolio(optimum, returns) show_optimal_portfolio(optimum, returns, preturns, pvariances) . Optimal weights: [0.122 0. 0.09 0.788] Expected return, volatility and Sharpe ratio: [0.14160147 0.23423143 0.60453661] . returns.mean() . MEG 0.000370 MAXS -0.000830 JFC 0.000258 ALI 0.000626 dtype: float64 . Resources: . Financial Mathematics https://www.springer.com/gp/book/9780857290816 | . | General Investing https://www.ig.com/en/learn-to-trade/ig-academy | . | .",
            "url": "https://enzoampil.github.io/fastquant-blog/portfolio/optimization/2020/06/20/basic_portfolio.html",
            "relUrl": "/portfolio/optimization/2020/06/20/basic_portfolio.html",
            "date": " • Jun 20, 2020"
        }
        
    
  
    
        ,"post1": {
            "title": "PSE stocks network analysis",
            "content": "# uncomment to install in colab #!pip3 install fastquant . The network module is used to visualize (close price) correlations among PSE stocks between specified dates. The details of how the network is built is described in the next section. For now, let&#39;s see the features of the module. . from fastquant import Network . # initialize network nw = Network() # plot network of PSE blue chips # each run may show different network representation fig = nw.plot_network() . [&#39;BH&#39;]: removed since &lt;1/2 of original data is left after outlier rejection . # show a specific sector nw = Network(sector=&#39;Services&#39;) fig = nw.plot_network() . [&#39;BH&#39;]: removed since &lt;1/2 of original data is left after outlier rejection . nw.all_subsectors . [&#39;Transportation Services&#39;, &#39;Property&#39;, &#39;Holding Firms&#39;, &#39;Media&#39;, &#39;Electricity, Energy, Power &amp; Water&#39;, &#39;Oil&#39;, &#39;Other Services&#39;, &#39;Mining&#39;, &#39;Hotel &amp; Leisure&#39;, &#39;Food, Beverage &amp; Tobacco&#39;, &#39;Retail&#39;, &#39;Information Technology&#39;, &#39;Banks&#39;, &#39;Other Financial Institutions&#39;, &#39;Casinos &amp; Gaming&#39;, &#39;Construction, Infrastructure &amp; Allied Services&#39;, &#39;Education&#39;, &#39;Chemicals&#39;, &#39;Electrical Components &amp; Equipment&#39;, &#39;Construction, Infra. &amp; Allied Services&#39;, &#39;Other Industrials&#39;, &#39;ETF-Equity&#39;, &#39;Telecommunications&#39;, &#39;Small, Medium &amp; Emerging Board&#39;, &#39;Food Beverage &amp; Tobacco&#39;] . # show subsectors in the given sector fig = nw.plot_network(show_subsector=True) . # focus on a specific stock # if symbol is given, only top 5 positive and top 5 negative stocks are considered nw = Network(symbol=&#39;BDO&#39;) fig = nw.plot_network(figsize=(5,5)) . [&#39;BH&#39;]: removed since &lt;1/2 of original data is left after outlier rejection . # changing date changes correlations nw = Network(symbol=&#39;BDO&#39;, start_date=&#39;2019-01-01&#39;, end_date=&#39;2020-04-01&#39; ) nw.price_corr[&#39;BDO&#39;].sort_values() . [&#39;AXLM&#39; &#39;FRUIT&#39; &#39;HOME&#39;]: removed since &lt;1/2 of original data is left after outlier rejection . Symbol TECH -0.465283 EMP -0.439232 FOOD -0.358610 LOTO -0.320371 TUGS -0.318638 SECB 0.797003 RLC 0.849220 JGS 0.886634 SM 0.904801 BDO 1.000000 Name: BDO, dtype: float64 . # compare to more recent date nw = Network(symbol=&#39;BDO&#39;, start_date=&#39;2020-01-01&#39;, end_date=&#39;2020-04-01&#39; ) nw.price_corr[&#39;BDO&#39;].sort_values() . [&#39;BH&#39; &#39;MJIC&#39;]: removed since &lt;1/2 of original data is left after outlier rejection . Symbol PRIM -0.450445 EMP -0.445236 SFI -0.233569 FPI -0.215350 LAND -0.210225 RLC 0.973440 AGI 0.974241 FPH 0.975656 JFC 0.977932 BDO 1.000000 Name: BDO, dtype: float64 . # compare with most correlated stock fig = nw.plot_corr_company(symbol=&#39;BDO&#39;) . # remove specific stock e.g. PRIM because it appears noisy nw = Network(symbol=&#39;BDO&#39;, start_date=&#39;2020-01-01&#39;, end_date=&#39;2020-04-01&#39;, exclude_symbols=[&quot;PRIM&quot;] ) fig = nw.plot_corr_company(symbol=&#39;BDO&#39;, positive=False) . Removed: [&#39;PRIM&#39;] [&#39;BH&#39; &#39;MJIC&#39;]: removed since &lt;1/2 of original data is left after outlier rejection . # specify distance metric: b for bonnano (default) or m for mktstk nw = Network(symbol=&#39;BDO&#39;, start_date=&#39;2020-01-01&#39;, end_date=&#39;2020-04-01&#39;, metric=&#39;m&#39; ) fig = nw.plot_network(figsize=(5,5)) . [&#39;BH&#39; &#39;MJIC&#39;]: removed since &lt;1/2 of original data is left after outlier rejection . Reconstruction . This notebook uses fastquant to retrieve recent PH stock data | Then we implement stock network analysis, based on Dr. Legara&#39;s notebook here, which includes: Setting up the correlation matrix for the stock prices in the Philippine Stock Exchange | Converting the resulting correlation matrix into a distance matrix | Building a minimum spanning tree from the distance matrix | . | The end result is a visual representation of network tree | . %matplotlib inline from pathlib import Path import numpy as np import matplotlib.pyplot as pl import matplotlib as mpl import pandas as pd import seaborn as sb import networkx as nx pl.style.use(&quot;default&quot;) from fastquant import get_pse_data_cache, get_stock_data, DATA_PATH . pull stock data using fastquant . df = get_pse_data_cache() df.tail() . Symbol 2GO AAA AB ABA ABG ABS AC ACE ... VMC VUL VVT WEB WIN WLCON WPI ZHI . open high low close value open high low close value open high low close value open high low close value open high low close value open high low close value open high low close value open high low close value ... open high low close value open high low close value open high low close value open high low close value open high low close value open high low close value open high low close value open high low close value . dt . 2020-04-24 10.0 | 12.5 | 9.50 | 10.92 | 58618684.0 | NaN | NaN | NaN | NaN | NaN | 10.7 | 10.7 | 10.7 | 10.70 | 5350.0 | 0.60 | 0.60 | 0.58 | 0.59 | 1524250.0 | 7.15 | 7.15 | 6.55 | 7.01 | 68943.0 | 16.78 | 16.80 | 16.60 | 16.60 | 1237072.0 | 575.0 | 579.0 | 550.0 | 550.0 | 213392310.0 | 1.24 | 1.24 | 1.11 | 1.11 | 10120.0 | ... | NaN | NaN | NaN | NaN | NaN | 0.70 | 0.72 | 0.69 | 0.69 | 218980.0 | NaN | NaN | NaN | NaN | NaN | 2.60 | 2.60 | 2.42 | 2.45 | 5648290.0 | 0.178 | 0.190 | 0.172 | 0.190 | 33960.0 | 14.1 | 14.40 | 13.80 | 14.10 | 68737970.0 | 0.415 | 0.420 | 0.400 | 0.420 | 628800.0 | 0.150 | 0.170 | 0.150 | 0.160 | 2505390.0 | . 2020-04-27 10.5 | 10.7 | 9.25 | 9.35 | 10153271.0 | NaN | NaN | NaN | NaN | NaN | 10.7 | 10.7 | 10.7 | 10.70 | 5350.0 | 0.59 | 0.59 | 0.56 | 0.57 | 2292910.0 | 7.11 | 7.36 | 7.04 | 7.08 | 59031.0 | 16.60 | 16.70 | 16.50 | 16.58 | 3100660.0 | 554.0 | 562.0 | 539.0 | 562.0 | 84857755.0 | NaN | NaN | NaN | NaN | NaN | ... | 2.31 | 2.5 | 2.31 | 2.5 | 18670.0 | 0.71 | 0.73 | 0.71 | 0.73 | 563290.0 | NaN | NaN | NaN | NaN | NaN | 2.42 | 2.42 | 2.23 | 2.30 | 7907100.0 | NaN | NaN | NaN | NaN | NaN | 14.1 | 14.10 | 13.70 | 14.00 | 12971588.0 | 0.410 | 0.420 | 0.395 | 0.420 | 429900.0 | 0.160 | 0.160 | 0.152 | 0.159 | 248070.0 | . 2020-04-28 9.1 | 10.0 | 8.60 | 9.40 | 5775296.0 | NaN | NaN | NaN | NaN | NaN | 10.5 | 10.7 | 10.5 | 10.70 | 97710.0 | 0.58 | 0.58 | 0.57 | 0.57 | 775260.0 | 7.46 | 7.46 | 7.09 | 7.16 | 53747.0 | 16.58 | 16.68 | 16.58 | 16.60 | 1177180.0 | 565.0 | 585.0 | 565.0 | 585.0 | 167054835.0 | NaN | NaN | NaN | NaN | NaN | ... | NaN | NaN | NaN | NaN | NaN | 0.73 | 0.80 | 0.71 | 0.73 | 3670650.0 | NaN | NaN | NaN | NaN | NaN | 2.33 | 2.45 | 2.27 | 2.28 | 4022590.0 | 0.190 | 0.190 | 0.190 | 0.190 | 7600.0 | 14.2 | 14.54 | 14.02 | 14.04 | 34476572.0 | 0.420 | 0.420 | 0.410 | 0.410 | 95700.0 | 0.153 | 0.164 | 0.153 | 0.160 | 63580.0 | . 2020-04-29 9.5 | 11.3 | 9.15 | 11.20 | 15292949.0 | NaN | NaN | NaN | NaN | NaN | 10.7 | 10.7 | 10.7 | 10.70 | 47080.0 | 0.57 | 0.59 | 0.57 | 0.59 | 1141190.0 | 7.29 | 7.78 | 7.20 | 7.59 | 167538.0 | 16.60 | 16.68 | 16.48 | 16.58 | 3194878.0 | 583.0 | 591.0 | 573.0 | 588.0 | 135116745.0 | NaN | NaN | NaN | NaN | NaN | ... | 2.50 | 2.5 | 2.50 | 2.5 | 2500.0 | 0.72 | 0.75 | 0.71 | 0.73 | 874220.0 | 13.52 | 13.52 | 13.52 | 13.52 | 1352.0 | 2.30 | 2.39 | 2.30 | 2.35 | 2876800.0 | 0.178 | 0.185 | 0.175 | 0.185 | 19470.0 | 14.3 | 14.30 | 13.90 | 14.00 | 54021960.0 | 0.405 | 0.410 | 0.400 | 0.410 | 101400.0 | 0.155 | 0.159 | 0.150 | 0.159 | 126950.0 | . 2020-04-30 10.7 | 12.2 | 10.50 | 10.60 | 20993480.0 | NaN | NaN | NaN | NaN | NaN | 10.9 | 10.9 | 10.3 | 10.88 | 16040.0 | 0.59 | 0.60 | 0.58 | 0.58 | 1892060.0 | 7.80 | 7.98 | 7.63 | 7.70 | 205503.0 | 17.10 | 18.20 | 17.10 | 18.00 | 19273438.0 | 582.5 | 586.5 | 580.5 | 582.0 | 199386850.0 | 1.13 | 1.13 | 1.13 | 1.13 | 1130.0 | ... | NaN | NaN | NaN | NaN | NaN | 0.74 | 0.74 | 0.71 | 0.73 | 473030.0 | NaN | NaN | NaN | NaN | NaN | 2.38 | 2.44 | 2.35 | 2.36 | 4604210.0 | 0.189 | 0.189 | 0.188 | 0.188 | 11290.0 | 14.0 | 14.70 | 14.00 | 14.70 | 33643662.0 | 0.400 | 0.415 | 0.400 | 0.415 | 137550.0 | 0.145 | 0.163 | 0.140 | 0.162 | 1607180.0 | . 5 rows × 1260 columns . #choose only close column df = df.xs(&#39;close&#39;, level=1, axis=1) df.head() . Symbol 2GO AAA AB ABA ABG ABS AC ACE ACEPH ACEX ACR AEV AGI ALCO ALHI ALI ALLHC ANI ANS AP APC APL APO APX AR ARA AT ATI ATN AUB AXLM BC BCOR BDO BEL BH BHI BKR BLFI BLOOM ... SFI SGI SGP SHLPH SHNG SLF SLI SM SMC SMPH SOC SPC SPM SSI SSP STI STR SUN T TBGI TECH TEL TFC TFHI TUGS UBP UNI UPM URC V VITA VLL VMC VUL VVT WEB WIN WLCON WPI ZHI . dt . 2010-01-04 NaN | 0.57 | 100.0 | 0.87 | NaN | 29.0 | 300.0 | NaN | 1.20 | NaN | 1.22 | 9.0 | 4.10 | NaN | NaN | 11.00 | NaN | 24.50 | 2.04 | 8.6 | NaN | NaN | 1.12 | 2.85 | NaN | 0.43 | 9.40 | NaN | 5.0 | NaN | NaN | 14.00 | 27.5 | 38.5 | 1.42 | NaN | 0.0875 | NaN | NaN | NaN | ... | 0.15 | NaN | NaN | NaN | 1.72 | NaN | NaN | 325.0 | 68.0 | 9.7 | 2.26 | NaN | NaN | NaN | NaN | NaN | NaN | 0.49 | 3.70 | 3.4 | NaN | 2600.0 | NaN | NaN | NaN | 36.5 | 0.0975 | 0.0075 | 15.75 | 1.30 | 0.40 | 1.90 | NaN | 0.61 | NaN | 18.00 | 0.120 | NaN | 0.3 | 0.200 | . 2010-01-05 1.14 | 0.46 | 100.0 | 0.87 | NaN | 29.0 | 300.0 | NaN | 1.26 | NaN | 1.22 | 9.1 | 4.15 | 0.18 | 8.3 | 10.75 | 0.41 | 24.25 | 2.08 | 8.8 | 0.35 | NaN | 1.22 | 2.80 | 0.0044 | NaN | 10.25 | NaN | 5.0 | NaN | NaN | 14.00 | 27.5 | 39.0 | 1.42 | NaN | 0.0900 | 1.24 | 1.30 | 10.0 | ... | 0.15 | 0.88 | NaN | NaN | 1.72 | 1220.0 | 0.84 | 320.0 | 67.5 | 9.9 | 2.50 | 3.4 | NaN | NaN | NaN | 1.32 | NaN | 0.49 | 3.70 | 3.4 | NaN | 2630.0 | NaN | NaN | NaN | 37.0 | 0.1100 | 0.0090 | 15.50 | 1.30 | 0.40 | 1.88 | NaN | 0.68 | NaN | 18.25 | 0.120 | NaN | NaN | 0.210 | . 2010-01-06 1.14 | NaN | 99.5 | 0.83 | NaN | 29.0 | 300.0 | 3.45 | 1.30 | NaN | 1.14 | 9.1 | 4.15 | 0.17 | NaN | 10.75 | 0.42 | 23.50 | 2.04 | 8.8 | 0.36 | NaN | 1.20 | 2.75 | 0.0044 | NaN | 10.50 | NaN | 5.0 | NaN | NaN | 13.75 | NaN | 39.0 | 1.42 | NaN | 0.0900 | NaN | 1.30 | 10.0 | ... | 0.15 | 0.89 | NaN | NaN | 1.72 | 1250.0 | 0.80 | 325.0 | 67.0 | 9.9 | 2.44 | 3.0 | NaN | NaN | NaN | 1.36 | NaN | 0.50 | 3.70 | 3.5 | NaN | 2640.0 | NaN | NaN | NaN | 37.5 | 0.1150 | 0.0085 | 17.00 | 1.28 | 0.39 | 1.90 | NaN | NaN | NaN | 18.25 | 0.120 | NaN | NaN | 0.215 | . 2010-01-07 1.14 | 0.42 | 100.0 | 0.84 | NaN | 29.0 | 297.5 | 3.00 | 1.26 | NaN | 1.28 | 9.1 | 4.35 | 0.17 | 8.3 | 11.25 | 0.45 | 25.50 | 2.06 | 8.9 | 0.37 | NaN | 1.20 | NaN | 0.0044 | NaN | 10.75 | 4.1 | NaN | NaN | NaN | 13.75 | 27.0 | 39.0 | 1.42 | NaN | 0.0925 | NaN | NaN | 9.5 | ... | 0.15 | 0.88 | NaN | NaN | NaN | 1260.0 | 0.79 | 322.5 | 72.0 | 9.8 | 2.48 | 3.4 | NaN | NaN | NaN | 1.50 | 2.5 | 0.51 | 3.75 | 3.5 | NaN | 2690.0 | NaN | NaN | NaN | 37.5 | 0.1200 | 0.0090 | 17.25 | 1.30 | 0.41 | 1.92 | NaN | NaN | NaN | 18.25 | 0.115 | NaN | 0.3 | 0.200 | . 2010-01-08 1.16 | 0.48 | 98.0 | 0.86 | NaN | 29.0 | 297.5 | 2.90 | 1.28 | NaN | 1.20 | 9.2 | 4.50 | 0.17 | NaN | 11.50 | 0.49 | 24.00 | 2.06 | 8.9 | 0.38 | NaN | 1.20 | 2.75 | 0.0044 | NaN | 11.25 | NaN | NaN | NaN | NaN | 13.75 | NaN | 39.0 | 1.44 | 250.0 | 0.0900 | 1.20 | 1.34 | NaN | ... | 0.15 | NaN | NaN | NaN | 1.76 | 1255.0 | 0.78 | 325.0 | 72.0 | 9.8 | 2.44 | NaN | NaN | NaN | NaN | 1.36 | NaN | 0.54 | 3.75 | 3.6 | NaN | 2695.0 | NaN | NaN | NaN | 37.0 | NaN | 0.0085 | 18.00 | 1.28 | NaN | 2.00 | NaN | 0.66 | NaN | 18.25 | 0.115 | NaN | NaN | 0.220 | . 5 rows × 252 columns . #choose recent data df = df[(df.index &gt;= &#39;2019-1-1&#39;) &amp; (df.index &lt;= &#39;2020-1-1&#39;)] df . Symbol 2GO AAA AB ABA ABG ABS AC ACE ACEPH ACEX ACR AEV AGI ALCO ALHI ALI ALLHC ANI ANS AP APC APL APO APX AR ARA AT ATI ATN AUB AXLM BC BCOR BDO BEL BH BHI BKR BLFI BLOOM ... SFI SGI SGP SHLPH SHNG SLF SLI SM SMC SMPH SOC SPC SPM SSI SSP STI STR SUN T TBGI TECH TEL TFC TFHI TUGS UBP UNI UPM URC V VITA VLL VMC VUL VVT WEB WIN WLCON WPI ZHI . dt . 2019-01-02 13.58 | NaN | 15.44 | 0.64 | 26.20 | 20.05 | 906.0 | 1.40 | 1.15 | 3.39 | 1.28 | 53.20 | 11.90 | 0.98 | 11.78 | 41.30 | 2.42 | 17.00 | 6.50 | 35.00 | 0.405 | 0.040 | NaN | 1.68 | 0.0020 | 1.72 | 2.65 | 14.68 | 1.44 | 59.35 | NaN | 1.45 | 3.43 | 127.0 | 2.35 | NaN | NaN | 1.48 | 2.11 | 9.64 | ... | 0.128 | 1.33 | NaN | 47.00 | NaN | NaN | 1.24 | 915.5 | 147.3 | 37.00 | NaN | 5.48 | 2.25 | 2.42 | 1.44 | 0.78 | 5.36 | 0.73 | 0.86 | 0.445 | 31.80 | 1130.0 | NaN | 249.8 | 3.00 | 63.60 | NaN | 0.0059 | 127.5 | NaN | 1.92 | 5.41 | 2.33 | 1.54 | NaN | 3.82 | 0.260 | 13.06 | 0.77 | 0.220 | . 2019-01-03 14.56 | NaN | 15.48 | 0.69 | 28.40 | 20.20 | 925.0 | 1.37 | 1.15 | 3.40 | 1.28 | 56.50 | 11.90 | 1.03 | 11.72 | 42.45 | 2.46 | 16.80 | 6.50 | 35.65 | 0.420 | 0.040 | NaN | 1.66 | 0.0020 | 1.71 | 2.80 | 14.02 | 1.45 | 59.50 | NaN | NaN | 3.54 | 129.5 | 2.39 | NaN | NaN | 1.48 | 2.14 | 9.87 | ... | 0.125 | 1.32 | NaN | 47.20 | 3.12 | 1849.0 | 1.26 | 958.0 | 149.0 | 38.00 | NaN | 5.64 | NaN | 2.53 | 1.44 | 0.82 | 5.48 | 0.72 | 0.87 | 0.445 | 30.95 | 1158.0 | NaN | 249.8 | 3.23 | 64.00 | NaN | 0.0060 | 128.5 | 1.13 | 1.94 | 5.46 | NaN | 1.63 | NaN | 3.59 | 0.275 | 12.90 | 0.78 | 0.226 | . 2019-01-04 14.34 | NaN | 16.50 | 0.71 | 27.50 | 20.35 | 960.0 | 1.34 | 1.16 | NaN | 1.29 | 57.00 | 11.80 | 1.00 | 11.68 | 43.70 | 2.45 | 16.94 | 6.50 | 35.70 | 0.420 | 0.039 | NaN | 1.69 | 0.0021 | 1.75 | 2.68 | 15.00 | 1.47 | 59.60 | NaN | 1.30 | 3.34 | 132.8 | 2.41 | NaN | NaN | 1.47 | 2.15 | 9.70 | ... | 0.125 | 1.33 | NaN | 47.30 | 3.12 | 1850.0 | 1.36 | 946.0 | 145.3 | 38.50 | 0.74 | 6.09 | NaN | 2.52 | 1.50 | 0.81 | 5.61 | NaN | 0.88 | 0.450 | 31.80 | 1160.0 | 40.00 | 249.8 | 3.30 | 64.40 | NaN | 0.0082 | 128.5 | NaN | 1.94 | 5.60 | NaN | 1.66 | NaN | 3.45 | 0.260 | 13.40 | 0.77 | 0.226 | . 2019-01-07 14.08 | NaN | 15.90 | 0.72 | 27.40 | 20.90 | 998.0 | 1.38 | 1.30 | 3.40 | 1.30 | 57.20 | 11.80 | 1.00 | NaN | 44.80 | 2.49 | 16.84 | 6.40 | 35.60 | 0.425 | 0.040 | 0.81 | 1.68 | 0.0021 | 1.74 | 2.71 | 14.98 | 1.46 | 59.60 | NaN | 1.30 | 3.43 | 129.5 | 2.45 | NaN | NaN | 1.46 | 2.18 | 10.12 | ... | NaN | 1.34 | NaN | 47.50 | 3.15 | NaN | 1.41 | 940.0 | 146.5 | 38.95 | 0.74 | 6.07 | NaN | 2.51 | 1.54 | 0.79 | 5.75 | 0.73 | 0.89 | 0.450 | 31.30 | 1148.0 | NaN | 249.8 | 3.25 | 64.40 | NaN | 0.0076 | 130.5 | 1.16 | 1.88 | 5.69 | NaN | 1.62 | NaN | 3.55 | 0.255 | 14.00 | 0.78 | 0.224 | . 2019-01-08 15.02 | NaN | 15.50 | 0.70 | 28.15 | 21.50 | 970.0 | 1.37 | NaN | NaN | 1.31 | 57.20 | 11.78 | 0.96 | 11.70 | 43.90 | 2.54 | 16.84 | 6.50 | 35.00 | 0.410 | 0.039 | 0.83 | 1.68 | 0.0020 | 1.74 | 2.70 | 14.98 | 1.43 | 59.50 | NaN | NaN | 3.45 | 129.0 | 2.38 | NaN | NaN | 1.51 | 2.10 | 10.00 | ... | 0.126 | 1.40 | 484.0 | 47.55 | 3.12 | 1802.0 | 1.40 | 938.0 | 146.5 | 38.05 | NaN | 6.23 | NaN | 2.43 | 1.55 | 0.75 | 5.93 | 0.73 | 0.88 | 0.450 | 30.70 | 1140.0 | NaN | 250.0 | 3.26 | 64.35 | NaN | 0.0077 | 130.0 | 1.17 | 1.90 | 5.65 | NaN | 1.64 | NaN | 3.45 | 0.248 | 13.74 | 0.78 | NaN | . ... ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | . 2019-12-19 9.48 | NaN | 10.92 | 0.78 | 10.68 | 15.80 | 755.0 | NaN | 2.31 | 7.15 | 1.23 | 50.95 | 11.32 | 0.80 | NaN | 45.40 | 3.05 | 13.30 | 6.57 | 33.10 | 0.385 | 0.042 | 0.70 | 0.92 | 0.0015 | 1.42 | 2.40 | 18.26 | 0.92 | 53.90 | 2.46 | NaN | 4.38 | 154.8 | 1.98 | NaN | NaN | 0.85 | 2.09 | 11.30 | ... | NaN | 1.22 | 172.0 | 33.35 | 3.18 | NaN | 2.48 | 1035.0 | 152.0 | 40.65 | 0.80 | 7.90 | NaN | 2.67 | 0.86 | 0.60 | 5.49 | 1.18 | 1.01 | 0.270 | 3.93 | 999.0 | 45.00 | 214.0 | 1.09 | 58.20 | NaN | 0.0052 | 143.0 | NaN | 1.13 | 7.35 | NaN | 0.88 | 15.30 | 2.35 | 0.202 | 18.16 | 0.57 | 0.190 | . 2019-12-20 9.42 | NaN | NaN | 0.82 | 10.76 | 15.82 | 779.5 | 1.49 | 2.31 | 7.20 | 1.22 | 51.55 | 11.50 | 0.80 | NaN | 46.00 | 2.98 | 13.30 | 6.42 | 34.05 | 0.390 | 0.042 | 0.71 | 0.90 | 0.0015 | 1.30 | 2.41 | 18.00 | 0.93 | 53.50 | 2.54 | NaN | 4.50 | 155.4 | 1.97 | NaN | NaN | NaN | NaN | 11.26 | ... | 0.115 | 1.22 | 175.0 | 33.30 | 3.10 | 1800.0 | 2.48 | 1065.0 | 158.0 | 41.45 | NaN | 8.20 | NaN | 2.68 | 0.89 | 0.63 | 5.48 | 1.17 | 1.00 | 0.275 | 3.82 | 1000.0 | NaN | 214.0 | 1.03 | 58.40 | NaN | 0.0053 | 144.0 | 1.08 | 1.12 | 7.30 | NaN | 0.89 | 15.14 | 2.43 | NaN | 17.84 | 0.60 | 0.209 | . 2019-12-23 9.78 | NaN | 10.96 | 0.87 | 10.82 | 15.80 | 779.0 | 1.49 | 2.27 | 7.15 | 1.28 | 52.00 | 11.46 | 0.80 | NaN | 47.25 | 2.99 | 13.40 | 6.42 | 33.50 | 0.395 | 0.042 | 0.69 | 0.92 | 0.0015 | 1.36 | NaN | NaN | 0.94 | 53.25 | 2.58 | NaN | 4.58 | 157.0 | 1.97 | NaN | NaN | 0.85 | NaN | 11.10 | ... | 0.120 | 1.22 | 188.0 | 33.20 | 3.06 | 1825.0 | 2.46 | 1078.0 | 160.0 | 41.95 | 0.79 | 8.21 | NaN | 2.75 | 0.87 | 0.62 | 5.60 | 1.20 | 1.02 | 0.275 | 4.00 | 1020.0 | 45.00 | 211.6 | 1.03 | 58.00 | NaN | 0.0053 | 151.9 | NaN | 1.17 | 7.35 | 2.57 | 0.88 | NaN | 2.40 | NaN | 17.70 | 0.61 | 0.190 | . 2019-12-26 9.89 | NaN | 10.96 | 0.87 | 10.48 | 15.80 | 800.0 | 1.54 | 2.27 | 7.45 | 1.23 | 51.95 | 11.60 | 0.80 | 8.95 | 46.40 | 3.01 | 13.46 | 6.70 | 33.85 | 0.380 | 0.042 | 0.68 | 0.96 | 0.0015 | 1.48 | NaN | NaN | 0.93 | 53.10 | 2.71 | NaN | 4.85 | 157.4 | 1.98 | NaN | NaN | 1.07 | 1.87 | 11.30 | ... | 0.115 | 1.25 | 200.0 | 32.95 | 3.10 | NaN | 2.44 | 1056.0 | 165.5 | 41.50 | NaN | 8.21 | NaN | 2.77 | 0.85 | 0.60 | 5.60 | 1.18 | 1.02 | 0.270 | 4.00 | 999.5 | 49.95 | 213.8 | 1.06 | 58.00 | NaN | 0.0052 | 148.0 | NaN | 1.17 | 7.35 | NaN | 0.88 | NaN | 2.54 | NaN | 17.70 | 0.61 | NaN | . 2019-12-27 10.50 | NaN | 10.96 | 0.86 | 10.46 | 15.80 | 785.5 | 1.40 | 2.23 | 7.32 | 1.21 | 51.50 | 11.66 | 0.81 | NaN | 45.50 | 2.99 | 13.50 | 6.42 | 34.20 | 0.390 | 0.043 | 0.69 | 0.99 | 0.0015 | 1.47 | 2.50 | 18.50 | 0.93 | NaN | 2.61 | 1.13 | 5.20 | 158.0 | 1.99 | NaN | NaN | 1.11 | 1.87 | 11.30 | ... | 0.117 | 1.22 | 195.0 | 32.80 | 3.20 | 1825.0 | 2.48 | 1043.0 | 164.0 | 42.10 | 0.79 | 8.19 | NaN | 2.78 | 0.85 | 0.60 | 5.66 | 1.23 | 1.02 | 0.270 | 4.07 | 988.0 | 49.95 | 214.0 | 1.07 | 57.70 | NaN | NaN | 145.0 | NaN | 1.20 | 7.73 | 2.60 | 0.86 | 15.12 | 2.61 | 0.202 | 18.00 | 0.60 | 0.200 | . 243 rows × 252 columns . #remove columns with NaNs df.dropna(axis=1, inplace=True) . Build correlation matrix . price_corr = df.corr() . ## Source: https://stanford.edu/~mwaskom/software/seaborn/examples/many_pairwise_correlations.html ## Generate a mask for the upper triangle mask = np.zeros_like(price_corr, dtype=np.bool) mask[np.triu_indices_from(mask)] = True ## Set up the matplotlib figure fig, ax = pl.subplots(figsize=(15, 15)) ## Generate a custom diverging colormap # cmap = sb.diverging_palette(220, 10, as_cmap=True) ## Draw the heatmap with the mask and correct aspect ratio sb.heatmap(price_corr, mask=mask, vmax=.3, #cmap=cmap, square=True, xticklabels=2, yticklabels=2, linewidths=.5, cbar_kws={&quot;shrink&quot;: .5}, ax=ax ) . &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f6d95ed80b8&gt; . def plot_corr(symbol, positive=True, rescale=True): corr = price_corr[symbol].sort_values(ascending=True) fig, ax = pl.subplots(1,2, figsize=(10,5)) if positive: symbol2 = corr.index[-2] else: symbol2 = corr.index[0] if rescale: d1 = df[symbol]/df[symbol].max() d2 = df[symbol2]/df[symbol2].max() _ = d1.plot(ax=ax[0], label=symbol) d2.apply(lambda x: x).plot(ax=ax[0], label=symbol2) else: _ = df[symbol].plot(ax=ax[0], label=symbol) df[symbol2].plot(ax=ax[0], label=symbol2) ax[0].legend() ax[1].plot(df[symbol], df[symbol2], &#39;o&#39;) pl.setp(ax[1], xlabel=symbol, ylabel=symbol2) return fig . fig = plot_corr(&#39;JFC&#39;, positive=True); . fig = plot_corr(&#39;JFC&#39;, positive=False); . build distance matrix . dist_bonanno = np.sqrt(2*(1-price_corr)) dist_mktstk = 1-abs(price_corr) labs_bonanno = list(dist_bonanno.index) labs_mktstk = list(dist_mktstk.index) . build minimum spanning tree . PSE-listed company names are taken from PSE and saved as csv file. | . G_bonanno = nx.from_numpy_matrix(dist_bonanno.values) G_mktstk = nx.from_numpy_matrix(dist_mktstk.values) . MST_b = nx.minimum_spanning_tree(G_bonanno) MST_m = nx.minimum_spanning_tree(G_mktstk) . stock_table = pd.read_csv(Path(DATA_PATH,&#39;stock_table.csv&#39;)) stock_table.head() . Company Name Stock Symbol Sector Subsector Listing Date company_id security_id . 0 2GO Group, Inc. | 2GO | Services | Transportation Services | May 15, 1995 | 29 | 146 | . 1 8990 Holdings, Inc. | HOUSE | Property | Property | Dec 09, 2010 | 626 | 563 | . 2 A Brown Company, Inc. | BRN | Property | Property | Feb 08, 1994 | 13 | 234 | . 3 A. Soriano Corporation | ANS | Holding Firms | Holding Firms | Oct 25, 1973 | 14 | 169 | . 4 ABS-CBN Corporation | ABS | Services | Media | Jul 08, 1992 | 114 | 123 | . MST_b.nodes . NodeView((0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101)) . for node in MST_b.nodes(): sector = stock_table[stock_table[&quot;Stock Symbol&quot;] == labs_bonanno[node]].Sector.iloc[0] MST_b.nodes[node][&quot;sector&quot;] = sector MST_b.nodes[node][&quot;label&quot;] = labs_bonanno[node] . for node in MST_m.nodes(): sector = stock_table[stock_table[&quot;Stock Symbol&quot;] == labs_mktstk[node]].Sector.iloc[0] MST_m.nodes[node][&quot;sector&quot;] = sector MST_m.nodes[node][&quot;label&quot;] = labs_mktstk[node] . Drawing MSTs . def map_sector_to_color(graph, dtype=&#39;int&#39;): sector_dict = nx.get_node_attributes(graph, &#39;sector&#39;) sector = pd.Series(sector_dict) if dtype==&#39;int&#39;: return sector.astype(&#39;category&#39;).cat.codes.values elif dtype==&#39;str&#39;: return sector.values elif dtype==&#39;cat&#39;: # {int: str} mapping d = dict(enumerate(sector.astype(&#39;category&#39;).cat.categories)) # {str: int} mapping (reverse) d = {v: k for k,v in d.items()} return d . def plot_network(graph, iterations=50, cmap=pl.get_cmap(&quot;Set1&quot;), figsize=(10,10)): &quot;&quot;&quot; Note: each instance may show different network structure &quot;&quot;&quot; fig = pl.figure(figsize=figsize, constrained_layout=True) nx.draw_networkx(graph, pos=nx.spring_layout(graph, iterations=iterations), labels=nx.get_node_attributes(graph, &#39;label&#39;), node_color=map_sector_to_color(graph), cmap=cmap, font_color=&#39;k&#39; ) #hack legend ColorLegend = map_sector_to_color(graph, dtype=&#39;cat&#39;) values = map_sector_to_color(graph, dtype=&#39;int&#39;) cNorm = mpl.colors.Normalize(vmin=0, vmax=max(values)) scalarMap = mpl.cm.ScalarMappable(norm=cNorm, cmap=cmap) for label in ColorLegend: pl.plot([0],[0], &#39;o&#39;, color=scalarMap.to_rgba(ColorLegend[label]), label=label ) pl.axis(&#39;off&#39;) pl.legend() return fig . fig = plot_network(MST_b) fig.suptitle(&#39;bonano&#39;) . Text(0.5, 0.98, &#39;bonano&#39;) . fig = plot_network(MST_m) fig.suptitle(&#39;mktstk&#39;) . Text(0.5, 0.98, &#39;mktstk&#39;) . Write out MSTs . nx.write_gexf(MST_b, Path(DATA_PATH,&quot;corrmat_bonanno.gexf&quot;)) nx.write_gexf(MST_m, Path(DATA_PATH,&quot;corrmat_mktstk.gexf&quot;)) . using sklearn (under development) . https://scikit-learn.org/stable/auto_examples/applications/plot_stock_market.html#sphx-glr-auto-examples-applications-plot-stock-market-py | . import pandas as pd fp = Path(DATA_PATH,&#39;bluechips.txt&#39;) bluechips = pd.read_csv(fp, delimiter=&#39; t&#39;, names=[&#39;symbol&#39;,&#39;name&#39;]) bluechips.head() . symbol name . 0 DMC | DMCI Holdings, Inc. | . 1 SCC | Semirara Mining and Power Corporation | . 2 AGI | Alliance Global Group, Inc. | . 3 LTG | LT Group, Inc. | . 4 MPI | Metro Pacific Investments Corporation | . from fastquant import get_pse_data_cache, get_stock_data cache = get_pse_data_cache() #drop non-bluechips stocks is_bluechips = cache.columns.levels[0].isin(bluechips.symbol) columns = cache.columns.levels[0][~is_bluechips] cache = cache.drop(columns=columns, level=0) #choose recent data df = cache[(cache.index &gt; &#39;2019-1-1&#39;) &amp; (cache.index &lt;= &#39;2020-1-1&#39;)] #drop stocks with NaNs df.dropna(axis=1, inplace=True) df.head() . Symbol AC AEV AGI ALI AP BDO BPI DMC ... RRHI SCC SECB SM SMC SMPH TEL URC . open high low close value open high low close value open high low close value open high low close value open high low close value open high low close value open high low close value open high low close value ... open high low close value open high low close value open high low close value open high low close value open high low close value open high low close value open high low close value open high low close value . dt . 2019-01-02 904.0 | 914.0 | 901.0 | 906.0 | 274766700.0 | 55.00 | 56.00 | 52.30 | 53.2 | 34863909.5 | 11.92 | 12.02 | 11.80 | 11.90 | 30179494.0 | 40.60 | 41.95 | 40.60 | 41.30 | 2.001608e+08 | 35.1 | 35.25 | 34.65 | 35.00 | 7198955.0 | 130.6 | 133.0 | 127.0 | 127.0 | 144321950.0 | 94.00 | 94.50 | 92.55 | 94.0 | 86508922.0 | 12.78 | 12.80 | 12.56 | 12.80 | 28794036.0 | ... | 80.95 | 81.90 | 80.95 | 81.75 | 12204542.0 | 23.05 | 23.30 | 23.05 | 23.20 | 9719705.0 | 156.0 | 159.7 | 154.6 | 154.6 | 59277655.0 | 927.5 | 928.0 | 910.0 | 915.5 | 151101190.0 | 147.9 | 147.9 | 146.0 | 147.3 | 40558795.0 | 35.85 | 37.0 | 35.85 | 37.00 | 285162400.0 | 1169.0 | 1169.0 | 1128.0 | 1130.0 | 32717665.0 | 128.4 | 128.5 | 125.7 | 127.5 | 37946221.0 | . 2019-01-03 913.5 | 932.0 | 907.5 | 925.0 | 635455000.0 | 54.75 | 56.50 | 53.35 | 56.5 | 57355705.0 | 11.90 | 12.00 | 11.88 | 11.90 | 66453378.0 | 41.25 | 42.50 | 40.75 | 42.45 | 6.039666e+08 | 35.0 | 35.70 | 35.00 | 35.65 | 34445655.0 | 128.0 | 129.5 | 126.8 | 129.5 | 379909284.0 | 94.00 | 95.00 | 92.50 | 95.0 | 184096302.0 | 12.62 | 13.00 | 12.62 | 13.00 | 56060238.0 | ... | 81.75 | 84.80 | 80.00 | 84.80 | 21112344.0 | 23.20 | 24.30 | 23.20 | 24.15 | 29251285.0 | 155.9 | 161.0 | 155.9 | 160.5 | 171959848.0 | 915.0 | 958.0 | 914.5 | 958.0 | 652288055.0 | 147.3 | 149.8 | 147.0 | 149.0 | 33602406.0 | 37.00 | 38.0 | 36.50 | 38.00 | 391460900.0 | 1139.0 | 1164.0 | 1134.0 | 1158.0 | 93279400.0 | 127.5 | 128.8 | 127.2 | 128.5 | 125876349.0 | . 2019-01-04 930.0 | 970.0 | 925.0 | 960.0 | 758288700.0 | 55.70 | 59.55 | 55.70 | 57.0 | 108420152.0 | 11.90 | 12.00 | 11.80 | 11.80 | 52850114.0 | 42.35 | 44.35 | 42.35 | 43.70 | 1.178707e+09 | 35.7 | 35.75 | 35.40 | 35.70 | 35899565.0 | 129.4 | 132.8 | 128.1 | 132.8 | 240720119.0 | 94.55 | 95.05 | 93.50 | 93.5 | 276257781.5 | 13.00 | 13.00 | 12.78 | 12.78 | 40099086.0 | ... | 84.50 | 88.65 | 83.90 | 88.00 | 102740118.5 | 24.20 | 24.85 | 24.20 | 24.70 | 37765350.0 | 160.5 | 164.7 | 160.2 | 163.3 | 151044135.0 | 951.0 | 965.0 | 946.0 | 946.0 | 565094590.0 | 149.0 | 149.8 | 145.1 | 145.3 | 151929259.0 | 37.50 | 38.5 | 37.50 | 38.50 | 521196840.0 | 1158.0 | 1185.0 | 1148.0 | 1160.0 | 104563580.0 | 128.5 | 130.5 | 127.5 | 128.5 | 448165602.0 | . 2019-01-07 965.0 | 998.0 | 965.0 | 998.0 | 773563980.0 | 58.25 | 59.20 | 57.20 | 57.2 | 59546580.0 | 11.96 | 11.96 | 11.74 | 11.80 | 153387832.0 | 43.80 | 45.00 | 43.80 | 44.80 | 7.556787e+08 | 35.8 | 36.00 | 35.50 | 35.60 | 40348750.0 | 133.0 | 133.3 | 129.5 | 129.5 | 199715492.0 | 94.00 | 95.70 | 93.00 | 93.0 | 238993565.5 | 12.78 | 12.92 | 12.60 | 12.60 | 65661158.0 | ... | 88.00 | 88.00 | 87.00 | 87.00 | 201512676.5 | 24.70 | 25.30 | 24.70 | 24.90 | 42902635.0 | 163.4 | 166.5 | 162.5 | 163.4 | 151563044.0 | 960.0 | 981.0 | 940.0 | 940.0 | 315327245.0 | 146.0 | 148.9 | 146.0 | 146.5 | 53146151.0 | 38.55 | 39.0 | 38.50 | 38.95 | 765314790.0 | 1160.0 | 1192.0 | 1148.0 | 1148.0 | 85935155.0 | 129.5 | 131.7 | 129.3 | 130.5 | 357013830.0 | . 2019-01-08 994.0 | 994.0 | 957.0 | 970.0 | 298600815.0 | 58.00 | 58.60 | 57.20 | 57.2 | 47004339.0 | 11.80 | 11.90 | 11.76 | 11.78 | 107662290.0 | 44.80 | 44.80 | 43.50 | 43.90 | 4.875464e+08 | 36.0 | 36.00 | 35.00 | 35.00 | 22124855.0 | 130.0 | 131.0 | 129.0 | 129.0 | 170497703.0 | 94.70 | 94.70 | 91.80 | 91.8 | 135137362.0 | 12.64 | 12.68 | 12.50 | 12.50 | 58964258.0 | ... | 87.00 | 88.00 | 84.80 | 84.80 | 101118554.0 | 24.95 | 25.10 | 24.30 | 24.40 | 18053790.0 | 164.0 | 166.0 | 162.8 | 163.5 | 179932997.0 | 944.0 | 955.5 | 932.0 | 938.0 | 212342825.0 | 148.0 | 148.7 | 146.4 | 146.5 | 175311008.0 | 38.50 | 38.9 | 37.80 | 38.05 | 240527305.0 | 1162.0 | 1177.0 | 1140.0 | 1140.0 | 48524835.0 | 131.0 | 131.3 | 129.5 | 130.0 | 222373222.0 | . 5 rows × 150 columns . import numpy as np import matplotlib.pyplot as pl from matplotlib.collections import LineCollection import pandas as pd from sklearn import cluster, covariance, manifold open_prices = df.xs(&#39;open&#39;, level=1, axis=1) close_prices = df.xs(&#39;close&#39;, level=1, axis=1) # The daily variations of the quotes are what carry most information variation = close_prices - open_prices # ############################################################################# # Learn a graphical structure from the correlations edge_model = covariance.GraphicalLassoCV() # standardize the time series: using correlations rather than covariance # is more efficient for structure recovery X = variation.copy().T X /= X.std(axis=0) edge_model.fit(X) # ############################################################################# # Cluster using affinity propagation _, labels = cluster.affinity_propagation(edge_model.covariance_) n_labels = labels.max() for i in range(n_labels + 1): print(&#39;Cluster {:d}: {}&#39;.format((i + 1), &#39;, &#39;.join(names[labels == i]))) # ############################################################################# # Find a low-dimension embedding for visualization: find the best position of # the nodes (the stocks) on a 2D plane # We use a dense eigen_solver to achieve reproducibility (arpack is # initiated with random vectors that we don&#39;t control). In addition, we # use a large number of neighbors to capture the large-scale structure. node_position_model = manifold.LocallyLinearEmbedding( n_components=2, eigen_solver=&#39;dense&#39;, n_neighbors=6) embedding = node_position_model.fit_transform(X.T).T . # ############################################################################# # Visualization pl.figure(1, facecolor=&#39;w&#39;, figsize=(10, 8)) pl.clf() ax = pl.axes([0., 0., 1., 1.]) pl.axis(&#39;off&#39;) # Display a graph of the partial correlations partial_correlations = edge_model.precision_.copy() d = 1 / np.sqrt(np.diag(partial_correlations)) partial_correlations *= d partial_correlations *= d[:, np.newaxis] non_zero = (np.abs(np.triu(partial_correlations, k=1)) &gt; 0.02) # Plot the nodes using the coordinates of our embedding pl.scatter(embedding[0], embedding[1], s=100 * d ** 2, c=labels, cmap=pl.cm.nipy_spectral) # Plot the edges start_idx, end_idx = np.where(non_zero) # a sequence of (*line0*, *line1*, *line2*), where:: # linen = (x0, y0), (x1, y1), ... (xm, ym) segments = [[embedding[:, start], embedding[:, stop]] for start, stop in zip(start_idx, end_idx)] values = np.abs(partial_correlations[non_zero]) lc = LineCollection(segments, zorder=0, cmap=pl.cm.hot_r, norm=pl.Normalize(0, .7 * values.max())) lc.set_array(values) lc.set_linewidths(15 * values) ax.add_collection(lc) # Add a label to each node. The challenge here is that we want to # position the labels to avoid overlap with other labels for index, (name, label, (x, y)) in enumerate( zip(bluechips.symbol, labels, embedding.T)): dx = x - embedding[0] dx[index] = 1 dy = y - embedding[1] dy[index] = 1 this_dx = dx[np.argmin(np.abs(dy))] this_dy = dy[np.argmin(np.abs(dx))] if this_dx &gt; 0: horizontalalignment = &#39;left&#39; x = x + .002 else: horizontalalignment = &#39;right&#39; x = x - .002 if this_dy &gt; 0: verticalalignment = &#39;bottom&#39; y = y + .002 else: verticalalignment = &#39;top&#39; y = y - .002 pl.text(x, y, name, size=10, horizontalalignment=horizontalalignment, verticalalignment=verticalalignment, bbox=dict(facecolor=&#39;w&#39;, edgecolor=pl.cm.nipy_spectral(label / float(n_labels)), alpha=.6)) pl.xlim(embedding[0].min() - .15 * embedding[0].ptp(), embedding[0].max() + .10 * embedding[0].ptp(),) pl.ylim(embedding[1].min() - .03 * embedding[1].ptp(), embedding[1].max() + .03 * embedding[1].ptp()) . (-0.20017287981885576, 0.1399809716203011) .",
            "url": "https://enzoampil.github.io/fastquant-blog/network/visualization/correlation/2020/06/10/network_analysis.html",
            "relUrl": "/network/visualization/correlation/2020/06/10/network_analysis.html",
            "date": " • Jun 10, 2020"
        }
        
    
  
    
        ,"post2": {
            "title": "Backtesting crypto",
            "content": "# uncomment to install in colab # !pip3 install fastquant . fetch data from binance . from fastquant import get_crypto_data crypto = get_crypto_data(&quot;BTC/USDT&quot;, &quot;2018-12-01&quot;, &quot;2019-12-31&quot;) . crypto . open high low close volume . dt . 2018-12-01 4041.27 | 4299.99 | 3963.01 | 4190.02 | 44840.073481 | . 2018-12-02 4190.98 | 4312.99 | 4103.04 | 4161.01 | 38912.154790 | . 2018-12-03 4160.55 | 4179.00 | 3827.00 | 3884.01 | 49094.369163 | . 2018-12-04 3884.76 | 4085.00 | 3781.00 | 3951.64 | 48489.551613 | . 2018-12-05 3950.98 | 3970.00 | 3745.00 | 3769.84 | 44004.799448 | . ... ... | ... | ... | ... | ... | . 2019-12-27 7202.00 | 7275.86 | 7076.42 | 7254.74 | 33642.701861 | . 2019-12-28 7254.77 | 7365.01 | 7238.67 | 7316.14 | 26848.982199 | . 2019-12-29 7315.36 | 7528.45 | 7288.00 | 7388.24 | 31387.106085 | . 2019-12-30 7388.43 | 7408.24 | 7220.00 | 7246.00 | 29605.911782 | . 2019-12-31 7246.00 | 7320.00 | 7145.01 | 7195.23 | 25954.453533 | . 396 rows × 5 columns . import matplotlib as mpl mpl.style.use(&quot;default&quot;) . run backtest with a grid of values . from fastquant import backtest results = backtest(&#39;smac&#39;, crypto, fast_period=[7,14,21,28], slow_period=[30,45,60,75], plot=False, verbose=False ) . ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 7 slow_period : 30 Final PnL: 69071.42 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 7 slow_period : 45 Final PnL: 100118.27 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 7 slow_period : 60 Final PnL: 89293.45 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 7 slow_period : 75 Final PnL: 158274.34 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 14 slow_period : 30 Final PnL: 61540.07 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 14 slow_period : 45 Final PnL: 66942.25 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 14 slow_period : 60 Final PnL: 49672.26 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 14 slow_period : 75 Final PnL: 129623.52 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 21 slow_period : 30 Final PnL: 19672.89 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 21 slow_period : 45 Final PnL: 62647.45 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 21 slow_period : 60 Final PnL: 82714.92 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 21 slow_period : 75 Final PnL: 118664.47 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 28 slow_period : 30 Final PnL: 403.13 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 28 slow_period : 45 Final PnL: 100206.68 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 28 slow_period : 60 Final PnL: 153759.0 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 28 slow_period : 75 Final PnL: 115821.6 Time used (seconds): 3.6864774227142334 Optimal parameters: {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;fast_period&#39;: 7, &#39;slow_period&#39;: 75} Optimal metrics: {&#39;rtot&#39;: 0.9488521619078212, &#39;ravg&#39;: 0.0023960913179490433, &#39;rnorm&#39;: 0.8290834824298609, &#39;rnorm100&#39;: 82.90834824298608, &#39;sharperatio&#39;: 0.9873637127933005, &#39;pnl&#39;: 158274.34, &#39;final_value&#39;: 258274.33860000005} . results.head() . init_cash buy_prop sell_prop execution_type fast_period slow_period rtot ravg rnorm rnorm100 sharperatio pnl final_value . 0 100000 | 1 | 1 | close | 7 | 75 | 0.948852 | 0.002396 | 0.829083 | 82.908348 | 0.987364 | 158274.34 | 258274.33860 | . 1 100000 | 1 | 1 | close | 28 | 60 | 0.931215 | 0.002352 | 0.808669 | 80.866904 | 0.986993 | 153759.00 | 253758.99660 | . 2 100000 | 1 | 1 | close | 14 | 75 | 0.831271 | 0.002099 | 0.697218 | 69.721824 | 0.984571 | 129623.52 | 229623.51945 | . 3 100000 | 1 | 1 | close | 21 | 75 | 0.782368 | 0.001976 | 0.645214 | 64.521440 | 0.983146 | 118664.47 | 218664.46810 | . 4 100000 | 1 | 1 | close | 28 | 75 | 0.769282 | 0.001943 | 0.631571 | 63.157054 | 0.982732 | 115821.60 | 215821.60410 | . That&#39;s a 258% maximum profit using only SMAC! . #get best parameters on top row fast_best, slow_best = results.iloc[0][[&quot;fast_period&quot;,&quot;slow_period&quot;]] fast_best, slow_best . (7, 75) . run backtest using optimum values . results = backtest(&#39;smac&#39;, crypto, fast_period=fast_best, slow_period=slow_best, plot=True, verbose=False ) . ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 7 slow_period : 75 Final PnL: 158274.34 Time used (seconds): 0.6577110290527344 Optimal parameters: {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;fast_period&#39;: 7, &#39;slow_period&#39;: 75} Optimal metrics: {&#39;rtot&#39;: 0.9488521619078212, &#39;ravg&#39;: 0.0023960913179490433, &#39;rnorm&#39;: 0.8290834824298609, &#39;rnorm100&#39;: 82.90834824298608, &#39;sharperatio&#39;: 0.9873637127933005, &#39;pnl&#39;: 158274.34, &#39;final_value&#39;: 258274.33860000005} .",
            "url": "https://enzoampil.github.io/fastquant-blog/crypto/backtest/grid%20search/2020/05/20/backtest_crypto.html",
            "relUrl": "/crypto/backtest/grid%20search/2020/05/20/backtest_crypto.html",
            "date": " • May 20, 2020"
        }
        
    
  
    
        ,"post3": {
            "title": "Backtesting a grid of multi-strategy parameters",
            "content": "# uncomment to install in colab # !pip3 install fastquant . Define strategies in a dictionary . from fastquant import backtest, get_stock_data df = get_stock_data(&quot;JFC&quot;, &quot;2018-01-01&quot;, &quot;2019-01-01&quot;) # Utilize single set of parameters strats = { &quot;smac&quot;: {&quot;fast_period&quot;: 35, &quot;slow_period&quot;: 50}, &quot;rsi&quot;: {&quot;rsi_lower&quot;: 30, &quot;rsi_upper&quot;: 70} } res = backtest(&quot;multi&quot;, df, strats=strats) res.shape # (1, 16) . Starting Portfolio Value: 100000.00 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 35 slow_period : 50 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== rsi_period : 14 rsi_upper : 70 rsi_lower : 30 2018-07-06, BUY CREATE, 251.00 2018-07-06, Cash: 100000.0 2018-07-06, Price: 251.0 2018-07-06, Buy prop size: 395 2018-07-06, Afforded size: 395 2018-07-06, Final size: 395 2018-07-09, BUY EXECUTED, Price: 251.00, Cost: 99145.00, Comm 743.59 2018-08-01, SELL CREATE, 276.00 2018-08-02, SELL EXECUTED, Price: 276.00, Cost: 99145.00, Comm 817.65 2018-08-02, OPERATION PROFIT, GROSS 9875.00, NET 8313.76 2018-08-29, BUY CREATE, 287.40 2018-08-29, Cash: 108313.76250000001 2018-08-29, Price: 287.4 2018-08-29, Buy prop size: 373 2018-08-29, Afforded size: 373 2018-08-29, Final size: 373 2018-08-30, BUY EXECUTED, Price: 287.40, Cost: 107200.20, Comm 804.00 2018-10-08, SELL CREATE, 252.40 2018-10-08, BUY CREATE, 243.00 2018-10-08, Cash: 309.5610000000147 2018-10-08, Price: 243.0 2018-10-08, Buy prop size: 1 2018-10-08, Afforded size: 1 2018-10-08, Final size: 1 2018-10-09, SELL EXECUTED, Price: 252.40, Cost: 107200.20, Comm 706.09 2018-10-09, OPERATION PROFIT, GROSS -13055.00, NET -14565.09 2018-10-09, BUY EXECUTED, Price: 243.00, Cost: 243.00, Comm 1.82 2018-11-22, BUY CREATE, 285.00 2018-11-22, Cash: 93503.84950000003 2018-11-22, Price: 285.0 2018-11-22, Buy prop size: 325 2018-11-22, Afforded size: 325 2018-11-22, Final size: 325 2018-11-23, BUY EXECUTED, Price: 285.00, Cost: 92625.00, Comm 694.69 2018-12-19, SELL CREATE, 303.00 2018-12-20, SELL EXECUTED, Price: 303.00, Cost: 92868.00, Comm 740.83 Final PnL: -1778.67 Final PnL: -1778.67 ================================================== Number of strat runs: 1 Number of strats per run: 2 Strat names: [&#39;smac&#39;, &#39;rsi&#39;] ************************************************** -- {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 35, &#39;smac.slow_period&#39;: 50, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 70, &#39;rsi.rsi_lower&#39;: 30} OrderedDict([(&#39;rtot&#39;, -0.0179468149815959), (&#39;ravg&#39;, -7.385520568557983e-05), (&#39;rnorm&#39;, -0.018439387134145634), (&#39;rnorm100&#39;, -1.8439387134145633)]) OrderedDict([(&#39;sharperatio&#39;, None)]) Time used (seconds): 0.06001472473144531 Optimal parameters: {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 35, &#39;smac.slow_period&#39;: 50, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 70, &#39;rsi.rsi_lower&#39;: 30} Optimal metrics: {&#39;rtot&#39;: -0.0179468149815959, &#39;ravg&#39;: -7.385520568557983e-05, &#39;rnorm&#39;: -0.018439387134145634, &#39;rnorm100&#39;: -1.8439387134145633, &#39;sharperatio&#39;: None, &#39;pnl&#39;: -1778.67, &#39;final_value&#39;: 98221.32700000002} . (1, 16) . Utilize auto grid search . strats_opt = { &quot;smac&quot;: {&quot;fast_period&quot;: [10,15], &quot;slow_period&quot;: [40, 60]}, &quot;rsi&quot;: {&quot;rsi_lower&quot;: [20, 30], &quot;rsi_upper&quot;: [70, 80]} } res_opt = backtest(&quot;multi&quot;, df, strats=strats_opt) res_opt.shape # (4, 16) . Starting Portfolio Value: 100000.00 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 10 slow_period : 40 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== rsi_period : 14 rsi_upper : 70 rsi_lower : 20 2018-04-12, BUY CREATE, 300.00 2018-04-12, Cash: 100000.0 2018-04-12, Price: 300.0 2018-04-12, Buy prop size: 330 2018-04-12, Afforded size: 330 2018-04-12, Final size: 330 2018-04-13, BUY EXECUTED, Price: 300.00, Cost: 99000.00, Comm 742.50 2018-04-13, SELL CREATE, 291.60 2018-04-16, SELL EXECUTED, Price: 291.60, Cost: 99000.00, Comm 721.71 2018-04-16, OPERATION PROFIT, GROSS -2772.00, NET -4236.21 2018-08-03, BUY CREATE, 277.00 2018-08-03, Cash: 95763.79 2018-08-03, Price: 277.0 2018-08-03, Buy prop size: 342 2018-08-03, Afforded size: 342 2018-08-03, Final size: 342 2018-08-06, BUY EXECUTED, Price: 277.00, Cost: 94734.00, Comm 710.50 2018-09-19, SELL CREATE, 271.00 2018-09-20, SELL EXECUTED, Price: 271.00, Cost: 94734.00, Comm 695.12 2018-09-20, OPERATION PROFIT, GROSS -2052.00, NET -3457.62 2018-10-30, BUY CREATE, 264.00 2018-10-30, Cash: 92306.16999999998 2018-10-30, Price: 264.0 2018-10-30, Buy prop size: 346 2018-10-30, Afforded size: 346 2018-10-30, Final size: 346 2018-10-31, BUY EXECUTED, Price: 264.00, Cost: 91344.00, Comm 685.08 2018-12-19, SELL CREATE, 303.00 2018-12-20, SELL EXECUTED, Price: 303.00, Cost: 91344.00, Comm 786.28 Final PnL: 4328.8 Final PnL: 4328.8 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 10 slow_period : 40 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== rsi_period : 14 rsi_upper : 80 rsi_lower : 20 2018-04-12, BUY CREATE, 300.00 2018-04-12, Cash: 100000.0 2018-04-12, Price: 300.0 2018-04-12, Buy prop size: 330 2018-04-12, Afforded size: 330 2018-04-12, Final size: 330 2018-04-13, BUY EXECUTED, Price: 300.00, Cost: 99000.00, Comm 742.50 2018-04-13, SELL CREATE, 291.60 2018-04-16, SELL EXECUTED, Price: 291.60, Cost: 99000.00, Comm 721.71 2018-04-16, OPERATION PROFIT, GROSS -2772.00, NET -4236.21 2018-08-03, BUY CREATE, 277.00 2018-08-03, Cash: 95763.79 2018-08-03, Price: 277.0 2018-08-03, Buy prop size: 342 2018-08-03, Afforded size: 342 2018-08-03, Final size: 342 2018-08-06, BUY EXECUTED, Price: 277.00, Cost: 94734.00, Comm 710.50 2018-09-19, SELL CREATE, 271.00 2018-09-20, SELL EXECUTED, Price: 271.00, Cost: 94734.00, Comm 695.12 2018-09-20, OPERATION PROFIT, GROSS -2052.00, NET -3457.62 2018-10-30, BUY CREATE, 264.00 2018-10-30, Cash: 92306.16999999998 2018-10-30, Price: 264.0 2018-10-30, Buy prop size: 346 2018-10-30, Afforded size: 346 2018-10-30, Final size: 346 2018-10-31, BUY EXECUTED, Price: 264.00, Cost: 91344.00, Comm 685.08 Final PnL: 1239.89 Final PnL: 1239.89 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 10 slow_period : 40 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== rsi_period : 14 rsi_upper : 70 rsi_lower : 30 2018-04-12, BUY CREATE, 300.00 2018-04-12, Cash: 100000.0 2018-04-12, Price: 300.0 2018-04-12, Buy prop size: 330 2018-04-12, Afforded size: 330 2018-04-12, Final size: 330 2018-04-13, BUY EXECUTED, Price: 300.00, Cost: 99000.00, Comm 742.50 2018-04-13, SELL CREATE, 291.60 2018-04-16, SELL EXECUTED, Price: 291.60, Cost: 99000.00, Comm 721.71 2018-04-16, OPERATION PROFIT, GROSS -2772.00, NET -4236.21 2018-07-06, BUY CREATE, 251.00 2018-07-06, Cash: 95763.79 2018-07-06, Price: 251.0 2018-07-06, Buy prop size: 378 2018-07-06, Afforded size: 378 2018-07-06, Final size: 378 2018-07-09, BUY EXECUTED, Price: 251.00, Cost: 94878.00, Comm 711.59 2018-08-01, SELL CREATE, 276.00 2018-08-02, SELL EXECUTED, Price: 276.00, Cost: 94878.00, Comm 782.46 2018-08-02, OPERATION PROFIT, GROSS 9450.00, NET 7955.95 2018-08-03, BUY CREATE, 277.00 2018-08-03, Cash: 103719.74499999998 2018-08-03, Price: 277.0 2018-08-03, Buy prop size: 371 2018-08-03, Afforded size: 371 2018-08-03, Final size: 371 2018-08-06, BUY EXECUTED, Price: 277.00, Cost: 102767.00, Comm 770.75 2018-09-19, SELL CREATE, 271.00 2018-09-20, SELL EXECUTED, Price: 271.00, Cost: 102767.00, Comm 754.06 2018-09-20, OPERATION PROFIT, GROSS -2226.00, NET -3750.81 2018-10-08, BUY CREATE, 243.00 2018-10-08, Cash: 99968.93499999998 2018-10-08, Price: 243.0 2018-10-08, Buy prop size: 407 2018-10-08, Afforded size: 407 2018-10-08, Final size: 407 2018-10-09, BUY EXECUTED, Price: 243.00, Cost: 98901.00, Comm 741.76 2018-10-30, BUY CREATE, 264.00 2018-10-30, Cash: 326.1774999999832 2018-10-30, Price: 264.0 2018-10-30, Buy prop size: 1 2018-10-30, Afforded size: 1 2018-10-30, Final size: 1 2018-10-31, BUY EXECUTED, Price: 264.00, Cost: 264.00, Comm 1.98 2018-12-19, SELL CREATE, 303.00 2018-12-20, SELL EXECUTED, Price: 303.00, Cost: 99165.00, Comm 927.18 Final PnL: 22757.02 Final PnL: 22757.02 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 10 slow_period : 40 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== rsi_period : 14 rsi_upper : 80 rsi_lower : 30 2018-04-12, BUY CREATE, 300.00 2018-04-12, Cash: 100000.0 2018-04-12, Price: 300.0 2018-04-12, Buy prop size: 330 2018-04-12, Afforded size: 330 2018-04-12, Final size: 330 2018-04-13, BUY EXECUTED, Price: 300.00, Cost: 99000.00, Comm 742.50 2018-04-13, SELL CREATE, 291.60 2018-04-16, SELL EXECUTED, Price: 291.60, Cost: 99000.00, Comm 721.71 2018-04-16, OPERATION PROFIT, GROSS -2772.00, NET -4236.21 2018-07-06, BUY CREATE, 251.00 2018-07-06, Cash: 95763.79 2018-07-06, Price: 251.0 2018-07-06, Buy prop size: 378 2018-07-06, Afforded size: 378 2018-07-06, Final size: 378 2018-07-09, BUY EXECUTED, Price: 251.00, Cost: 94878.00, Comm 711.59 2018-09-19, SELL CREATE, 271.00 2018-09-20, SELL EXECUTED, Price: 271.00, Cost: 94878.00, Comm 768.28 2018-10-08, BUY CREATE, 243.00 2018-10-08, Cash: 101843.91999999998 2018-10-08, Price: 243.0 2018-10-08, Buy prop size: 415 2018-10-08, Afforded size: 415 2018-10-08, Final size: 415 2018-10-09, BUY EXECUTED, Price: 243.00, Cost: 100845.00, Comm 756.34 Final PnL: 21339.58 Final PnL: 21339.58 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 10 slow_period : 60 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== rsi_period : 14 rsi_upper : 70 rsi_lower : 20 2018-04-23, BUY CREATE, 294.00 2018-04-23, Cash: 100000.0 2018-04-23, Price: 294.0 2018-04-23, Buy prop size: 337 2018-04-23, Afforded size: 337 2018-04-23, Final size: 337 2018-04-24, BUY EXECUTED, Price: 294.00, Cost: 99078.00, Comm 743.08 2018-04-26, SELL CREATE, 282.00 2018-04-27, SELL EXECUTED, Price: 282.00, Cost: 99078.00, Comm 712.75 2018-04-27, OPERATION PROFIT, GROSS -4044.00, NET -5499.84 2018-08-08, BUY CREATE, 276.80 2018-08-08, Cash: 94500.15999999999 2018-08-08, Price: 276.8 2018-08-08, Buy prop size: 338 2018-08-08, Afforded size: 338 2018-08-08, Final size: 338 2018-08-09, BUY EXECUTED, Price: 276.80, Cost: 93558.40, Comm 701.69 2018-09-28, SELL CREATE, 252.00 2018-10-01, SELL EXECUTED, Price: 252.00, Cost: 93558.40, Comm 638.82 2018-10-01, OPERATION PROFIT, GROSS -8382.40, NET -9722.91 2018-11-06, BUY CREATE, 278.60 2018-11-06, Cash: 84777.25199999998 2018-11-06, Price: 278.6 2018-11-06, Buy prop size: 301 2018-11-06, Afforded size: 301 2018-11-06, Final size: 301 2018-11-07, BUY EXECUTED, Price: 278.60, Cost: 83858.60, Comm 628.94 2018-12-19, SELL CREATE, 303.00 2018-12-20, SELL EXECUTED, Price: 303.00, Cost: 83858.60, Comm 684.02 Final PnL: -9191.31 Final PnL: -9191.31 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 10 slow_period : 60 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== rsi_period : 14 rsi_upper : 80 rsi_lower : 20 2018-04-23, BUY CREATE, 294.00 2018-04-23, Cash: 100000.0 2018-04-23, Price: 294.0 2018-04-23, Buy prop size: 337 2018-04-23, Afforded size: 337 2018-04-23, Final size: 337 2018-04-24, BUY EXECUTED, Price: 294.00, Cost: 99078.00, Comm 743.08 2018-04-26, SELL CREATE, 282.00 2018-04-27, SELL EXECUTED, Price: 282.00, Cost: 99078.00, Comm 712.75 2018-04-27, OPERATION PROFIT, GROSS -4044.00, NET -5499.84 2018-08-08, BUY CREATE, 276.80 2018-08-08, Cash: 94500.15999999999 2018-08-08, Price: 276.8 2018-08-08, Buy prop size: 338 2018-08-08, Afforded size: 338 2018-08-08, Final size: 338 2018-08-09, BUY EXECUTED, Price: 276.80, Cost: 93558.40, Comm 701.69 2018-09-28, SELL CREATE, 252.00 2018-10-01, SELL EXECUTED, Price: 252.00, Cost: 93558.40, Comm 638.82 2018-10-01, OPERATION PROFIT, GROSS -8382.40, NET -9722.91 2018-11-06, BUY CREATE, 278.60 2018-11-06, Cash: 84777.25199999998 2018-11-06, Price: 278.6 2018-11-06, Buy prop size: 301 2018-11-06, Afforded size: 301 2018-11-06, Final size: 301 2018-11-07, BUY EXECUTED, Price: 278.60, Cost: 83858.60, Comm 628.94 Final PnL: -11878.49 Final PnL: -11878.49 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 10 slow_period : 60 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== rsi_period : 14 rsi_upper : 70 rsi_lower : 30 2018-04-23, BUY CREATE, 294.00 2018-04-23, Cash: 100000.0 2018-04-23, Price: 294.0 2018-04-23, Buy prop size: 337 2018-04-23, Afforded size: 337 2018-04-23, Final size: 337 2018-04-24, BUY EXECUTED, Price: 294.00, Cost: 99078.00, Comm 743.08 2018-04-26, SELL CREATE, 282.00 2018-04-27, SELL EXECUTED, Price: 282.00, Cost: 99078.00, Comm 712.75 2018-04-27, OPERATION PROFIT, GROSS -4044.00, NET -5499.84 2018-07-06, BUY CREATE, 251.00 2018-07-06, Cash: 94500.15999999999 2018-07-06, Price: 251.0 2018-07-06, Buy prop size: 373 2018-07-06, Afforded size: 373 2018-07-06, Final size: 373 2018-07-09, BUY EXECUTED, Price: 251.00, Cost: 93623.00, Comm 702.17 2018-08-01, SELL CREATE, 276.00 2018-08-02, SELL EXECUTED, Price: 276.00, Cost: 93623.00, Comm 772.11 2018-08-02, OPERATION PROFIT, GROSS 9325.00, NET 7850.72 2018-08-08, BUY CREATE, 276.80 2018-08-08, Cash: 102350.87749999999 2018-08-08, Price: 276.8 2018-08-08, Buy prop size: 366 2018-08-08, Afforded size: 366 2018-08-08, Final size: 366 2018-08-09, BUY EXECUTED, Price: 276.80, Cost: 101308.80, Comm 759.82 2018-09-28, SELL CREATE, 252.00 2018-10-01, SELL EXECUTED, Price: 252.00, Cost: 101308.80, Comm 691.74 2018-10-01, OPERATION PROFIT, GROSS -9076.80, NET -10528.36 2018-10-08, BUY CREATE, 243.00 2018-10-08, Cash: 91822.52149999997 2018-10-08, Price: 243.0 2018-10-08, Buy prop size: 374 2018-10-08, Afforded size: 374 2018-10-08, Final size: 374 2018-10-09, BUY EXECUTED, Price: 243.00, Cost: 90882.00, Comm 681.61 2018-12-19, SELL CREATE, 303.00 2018-12-20, SELL EXECUTED, Price: 303.00, Cost: 90882.00, Comm 849.91 2018-12-20, OPERATION PROFIT, GROSS 22440.00, NET 20908.47 Final PnL: 12730.99 Final PnL: 12730.99 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 10 slow_period : 60 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== rsi_period : 14 rsi_upper : 80 rsi_lower : 30 2018-04-23, BUY CREATE, 294.00 2018-04-23, Cash: 100000.0 2018-04-23, Price: 294.0 2018-04-23, Buy prop size: 337 2018-04-23, Afforded size: 337 2018-04-23, Final size: 337 2018-04-24, BUY EXECUTED, Price: 294.00, Cost: 99078.00, Comm 743.08 2018-04-26, SELL CREATE, 282.00 2018-04-27, SELL EXECUTED, Price: 282.00, Cost: 99078.00, Comm 712.75 2018-04-27, OPERATION PROFIT, GROSS -4044.00, NET -5499.84 2018-07-06, BUY CREATE, 251.00 2018-07-06, Cash: 94500.15999999999 2018-07-06, Price: 251.0 2018-07-06, Buy prop size: 373 2018-07-06, Afforded size: 373 2018-07-06, Final size: 373 2018-07-09, BUY EXECUTED, Price: 251.00, Cost: 93623.00, Comm 702.17 2018-09-28, SELL CREATE, 252.00 2018-10-01, SELL EXECUTED, Price: 252.00, Cost: 93623.00, Comm 704.97 2018-10-08, BUY CREATE, 243.00 2018-10-08, Cash: 93466.01749999999 2018-10-08, Price: 243.0 2018-10-08, Buy prop size: 381 2018-10-08, Afforded size: 381 2018-10-08, Final size: 381 2018-10-09, BUY EXECUTED, Price: 243.00, Cost: 92583.00, Comm 694.37 Final PnL: 11364.44 Final PnL: 11364.44 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 15 slow_period : 40 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== rsi_period : 14 rsi_upper : 70 rsi_lower : 20 2018-08-07, BUY CREATE, 270.00 2018-08-07, Cash: 100000.0 2018-08-07, Price: 270.0 2018-08-07, Buy prop size: 367 2018-08-07, Afforded size: 367 2018-08-07, Final size: 367 2018-08-08, BUY EXECUTED, Price: 270.00, Cost: 99090.00, Comm 743.17 2018-09-21, SELL CREATE, 271.00 2018-09-24, SELL EXECUTED, Price: 271.00, Cost: 99090.00, Comm 745.93 2018-09-24, OPERATION PROFIT, GROSS 367.00, NET -1122.10 2018-11-05, BUY CREATE, 280.00 2018-11-05, Cash: 98877.89749999999 2018-11-05, Price: 280.0 2018-11-05, Buy prop size: 350 2018-11-05, Afforded size: 350 2018-11-05, Final size: 350 2018-11-06, BUY EXECUTED, Price: 280.00, Cost: 98000.00, Comm 735.00 2018-12-19, SELL CREATE, 303.00 2018-12-20, SELL EXECUTED, Price: 303.00, Cost: 98000.00, Comm 795.38 Final PnL: 5397.52 Final PnL: 5397.52 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 15 slow_period : 40 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== rsi_period : 14 rsi_upper : 80 rsi_lower : 20 2018-08-07, BUY CREATE, 270.00 2018-08-07, Cash: 100000.0 2018-08-07, Price: 270.0 2018-08-07, Buy prop size: 367 2018-08-07, Afforded size: 367 2018-08-07, Final size: 367 2018-08-08, BUY EXECUTED, Price: 270.00, Cost: 99090.00, Comm 743.17 2018-09-21, SELL CREATE, 271.00 2018-09-24, SELL EXECUTED, Price: 271.00, Cost: 99090.00, Comm 745.93 2018-09-24, OPERATION PROFIT, GROSS 367.00, NET -1122.10 2018-11-05, BUY CREATE, 280.00 2018-11-05, Cash: 98877.89749999999 2018-11-05, Price: 280.0 2018-11-05, Buy prop size: 350 2018-11-05, Afforded size: 350 2018-11-05, Final size: 350 2018-11-06, BUY EXECUTED, Price: 280.00, Cost: 98000.00, Comm 735.00 Final PnL: 2272.9 Final PnL: 2272.9 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 15 slow_period : 40 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== rsi_period : 14 rsi_upper : 70 rsi_lower : 30 2018-07-06, BUY CREATE, 251.00 2018-07-06, Cash: 100000.0 2018-07-06, Price: 251.0 2018-07-06, Buy prop size: 395 2018-07-06, Afforded size: 395 2018-07-06, Final size: 395 2018-07-09, BUY EXECUTED, Price: 251.00, Cost: 99145.00, Comm 743.59 2018-08-01, SELL CREATE, 276.00 2018-08-02, SELL EXECUTED, Price: 276.00, Cost: 99145.00, Comm 817.65 2018-08-02, OPERATION PROFIT, GROSS 9875.00, NET 8313.76 2018-08-07, BUY CREATE, 270.00 2018-08-07, Cash: 108313.76250000001 2018-08-07, Price: 270.0 2018-08-07, Buy prop size: 397 2018-08-07, Afforded size: 397 2018-08-07, Final size: 397 2018-08-08, BUY EXECUTED, Price: 270.00, Cost: 107190.00, Comm 803.92 2018-09-21, SELL CREATE, 271.00 2018-09-24, SELL EXECUTED, Price: 271.00, Cost: 107190.00, Comm 806.90 2018-09-24, OPERATION PROFIT, GROSS 397.00, NET -1213.83 2018-10-08, BUY CREATE, 243.00 2018-10-08, Cash: 107099.93500000001 2018-10-08, Price: 243.0 2018-10-08, Buy prop size: 437 2018-10-08, Afforded size: 437 2018-10-08, Final size: 437 2018-10-09, BUY EXECUTED, Price: 243.00, Cost: 106191.00, Comm 796.43 2018-12-19, SELL CREATE, 303.00 2018-12-20, SELL EXECUTED, Price: 303.00, Cost: 106191.00, Comm 993.08 2018-12-20, OPERATION PROFIT, GROSS 26220.00, NET 24430.49 Final PnL: 31530.42 Final PnL: 31530.42 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 15 slow_period : 40 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== rsi_period : 14 rsi_upper : 80 rsi_lower : 30 2018-07-06, BUY CREATE, 251.00 2018-07-06, Cash: 100000.0 2018-07-06, Price: 251.0 2018-07-06, Buy prop size: 395 2018-07-06, Afforded size: 395 2018-07-06, Final size: 395 2018-07-09, BUY EXECUTED, Price: 251.00, Cost: 99145.00, Comm 743.59 2018-09-21, SELL CREATE, 271.00 2018-09-24, SELL EXECUTED, Price: 271.00, Cost: 99145.00, Comm 802.84 2018-10-08, BUY CREATE, 243.00 2018-10-08, Cash: 106353.57500000001 2018-10-08, Price: 243.0 2018-10-08, Buy prop size: 433 2018-10-08, Afforded size: 433 2018-10-08, Final size: 433 2018-10-09, BUY EXECUTED, Price: 243.00, Cost: 105219.00, Comm 789.14 2018-11-05, BUY CREATE, 280.00 2018-11-05, Cash: 345.4325000000116 2018-11-05, Price: 280.0 2018-11-05, Buy prop size: 1 2018-11-05, Afforded size: 1 2018-11-05, Final size: 1 2018-11-06, BUY EXECUTED, Price: 280.00, Cost: 280.00, Comm 2.10 Final PnL: 26704.53 Final PnL: 26704.53 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 15 slow_period : 60 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== rsi_period : 14 rsi_upper : 70 rsi_lower : 20 2018-08-14, BUY CREATE, 273.40 2018-08-14, Cash: 100000.0 2018-08-14, Price: 273.4 2018-08-14, Buy prop size: 362 2018-08-14, Afforded size: 362 2018-08-14, Final size: 362 2018-08-15, BUY EXECUTED, Price: 273.40, Cost: 98970.80, Comm 742.28 2018-10-01, SELL CREATE, 250.00 2018-10-02, SELL EXECUTED, Price: 250.00, Cost: 98970.80, Comm 678.75 2018-10-02, OPERATION PROFIT, GROSS -8470.80, NET -9891.83 2018-11-08, BUY CREATE, 280.00 2018-11-08, Cash: 90108.16900000001 2018-11-08, Price: 280.0 2018-11-08, Buy prop size: 319 2018-11-08, Afforded size: 319 2018-11-08, Final size: 319 2018-11-09, BUY EXECUTED, Price: 280.00, Cost: 89320.00, Comm 669.90 2018-12-19, SELL CREATE, 303.00 2018-12-20, SELL EXECUTED, Price: 303.00, Cost: 89320.00, Comm 724.93 Final PnL: -3949.66 Final PnL: -3949.66 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 15 slow_period : 60 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== rsi_period : 14 rsi_upper : 80 rsi_lower : 20 2018-08-14, BUY CREATE, 273.40 2018-08-14, Cash: 100000.0 2018-08-14, Price: 273.4 2018-08-14, Buy prop size: 362 2018-08-14, Afforded size: 362 2018-08-14, Final size: 362 2018-08-15, BUY EXECUTED, Price: 273.40, Cost: 98970.80, Comm 742.28 2018-10-01, SELL CREATE, 250.00 2018-10-02, SELL EXECUTED, Price: 250.00, Cost: 98970.80, Comm 678.75 2018-10-02, OPERATION PROFIT, GROSS -8470.80, NET -9891.83 2018-11-08, BUY CREATE, 280.00 2018-11-08, Cash: 90108.16900000001 2018-11-08, Price: 280.0 2018-11-08, Buy prop size: 319 2018-11-08, Afforded size: 319 2018-11-08, Final size: 319 2018-11-09, BUY EXECUTED, Price: 280.00, Cost: 89320.00, Comm 669.90 Final PnL: -6797.53 Final PnL: -6797.53 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 15 slow_period : 60 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== rsi_period : 14 rsi_upper : 70 rsi_lower : 30 2018-07-06, BUY CREATE, 251.00 2018-07-06, Cash: 100000.0 2018-07-06, Price: 251.0 2018-07-06, Buy prop size: 395 2018-07-06, Afforded size: 395 2018-07-06, Final size: 395 2018-07-09, BUY EXECUTED, Price: 251.00, Cost: 99145.00, Comm 743.59 2018-08-01, SELL CREATE, 276.00 2018-08-02, SELL EXECUTED, Price: 276.00, Cost: 99145.00, Comm 817.65 2018-08-02, OPERATION PROFIT, GROSS 9875.00, NET 8313.76 2018-08-14, BUY CREATE, 273.40 2018-08-14, Cash: 108313.76250000001 2018-08-14, Price: 273.4 2018-08-14, Buy prop size: 392 2018-08-14, Afforded size: 392 2018-08-14, Final size: 392 2018-08-15, BUY EXECUTED, Price: 273.40, Cost: 107172.80, Comm 803.80 2018-10-01, SELL CREATE, 250.00 2018-10-02, SELL EXECUTED, Price: 250.00, Cost: 107172.80, Comm 735.00 2018-10-02, OPERATION PROFIT, GROSS -9172.80, NET -10711.60 2018-10-08, BUY CREATE, 243.00 2018-10-08, Cash: 97602.16650000002 2018-10-08, Price: 243.0 2018-10-08, Buy prop size: 398 2018-10-08, Afforded size: 398 2018-10-08, Final size: 398 2018-10-09, BUY EXECUTED, Price: 243.00, Cost: 96714.00, Comm 725.36 2018-12-19, SELL CREATE, 303.00 2018-12-20, SELL EXECUTED, Price: 303.00, Cost: 96714.00, Comm 904.45 2018-12-20, OPERATION PROFIT, GROSS 23880.00, NET 22250.19 Final PnL: 19852.36 Final PnL: 19852.36 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 15 slow_period : 60 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== rsi_period : 14 rsi_upper : 80 rsi_lower : 30 2018-07-06, BUY CREATE, 251.00 2018-07-06, Cash: 100000.0 2018-07-06, Price: 251.0 2018-07-06, Buy prop size: 395 2018-07-06, Afforded size: 395 2018-07-06, Final size: 395 2018-07-09, BUY EXECUTED, Price: 251.00, Cost: 99145.00, Comm 743.59 2018-10-01, SELL CREATE, 250.00 2018-10-02, SELL EXECUTED, Price: 250.00, Cost: 99145.00, Comm 740.62 2018-10-08, BUY CREATE, 243.00 2018-10-08, Cash: 98120.7875 2018-10-08, Price: 243.0 2018-10-08, Buy prop size: 400 2018-10-08, Afforded size: 400 2018-10-08, Final size: 400 2018-10-09, BUY EXECUTED, Price: 243.00, Cost: 97200.00, Comm 729.00 Final PnL: 16911.79 Final PnL: 16911.79 ================================================== Number of strat runs: 16 Number of strats per run: 2 Strat names: [&#39;smac&#39;, &#39;rsi&#39;] ************************************************** -- {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 10, &#39;smac.slow_period&#39;: 40, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 70, &#39;rsi.rsi_lower&#39;: 20} OrderedDict([(&#39;rtot&#39;, 0.042377312386123134), (&#39;ravg&#39;, 0.000174392232041659), (&#39;rnorm&#39;, 0.04492680768865365), (&#39;rnorm100&#39;, 4.492680768865364)]) OrderedDict([(&#39;sharperatio&#39;, None)]) ************************************************** -- {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 10, &#39;smac.slow_period&#39;: 40, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 80, &#39;rsi.rsi_lower&#39;: 20} OrderedDict([(&#39;rtot&#39;, 0.012322663161177035), (&#39;ravg&#39;, 5.071054798838286e-05), (&#39;rnorm&#39;, 0.012861059182548444), (&#39;rnorm100&#39;, 1.2861059182548444)]) OrderedDict([(&#39;sharperatio&#39;, None)]) ************************************************** -- {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 10, &#39;smac.slow_period&#39;: 40, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 70, &#39;rsi.rsi_lower&#39;: 30} OrderedDict([(&#39;rtot&#39;, 0.2050367480952209), (&#39;ravg&#39;, 0.0008437726259062589), (&#39;rnorm&#39;, 0.23692777159818812), (&#39;rnorm100&#39;, 23.69277715981881)]) OrderedDict([(&#39;sharperatio&#39;, None)]) ************************************************** -- {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 10, &#39;smac.slow_period&#39;: 40, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 80, &#39;rsi.rsi_lower&#39;: 30} OrderedDict([(&#39;rtot&#39;, 0.19342289577512692), (&#39;ravg&#39;, 0.00079597899495937), (&#39;rnorm&#39;, 0.2221195736378016), (&#39;rnorm100&#39;, 22.21195736378016)]) OrderedDict([(&#39;sharperatio&#39;, None)]) ************************************************** -- {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 10, &#39;smac.slow_period&#39;: 60, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 70, &#39;rsi.rsi_lower&#39;: 20} OrderedDict([(&#39;rtot&#39;, -0.0964152001144457), (&#39;ravg&#39;, -0.0003967703708413403), (&#39;rnorm&#39;, -0.0951500349055751), (&#39;rnorm100&#39;, -9.51500349055751)]) OrderedDict([(&#39;sharperatio&#39;, None)]) ************************************************** -- {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 10, &#39;smac.slow_period&#39;: 60, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 80, &#39;rsi.rsi_lower&#39;: 20} OrderedDict([(&#39;rtot&#39;, -0.12645350010683382), (&#39;ravg&#39;, -0.0005203847741021968), (&#39;rnorm&#39;, -0.12290236382425088), (&#39;rnorm100&#39;, -12.290236382425087)]) OrderedDict([(&#39;sharperatio&#39;, None)]) ************************************************** -- {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 10, &#39;smac.slow_period&#39;: 60, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 70, &#39;rsi.rsi_lower&#39;: 30} OrderedDict([(&#39;rtot&#39;, 0.11983418838139474), (&#39;ravg&#39;, 0.0004931448081538878), (&#39;rnorm&#39;, 0.13232437790797075), (&#39;rnorm100&#39;, 13.232437790797075)]) OrderedDict([(&#39;sharperatio&#39;, None)]) ************************************************** -- {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 10, &#39;smac.slow_period&#39;: 60, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 80, &#39;rsi.rsi_lower&#39;: 30} OrderedDict([(&#39;rtot&#39;, 0.10763792539049269), (&#39;ravg&#39;, 0.00044295442547527856), (&#39;rnorm&#39;, 0.11809295492841805), (&#39;rnorm100&#39;, 11.809295492841805)]) OrderedDict([(&#39;sharperatio&#39;, None)]) ************************************************** -- {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 15, &#39;smac.slow_period&#39;: 40, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 70, &#39;rsi.rsi_lower&#39;: 20} OrderedDict([(&#39;rtot&#39;, 0.052568944150307696), (&#39;ravg&#39;, 0.00021633310349920864), (&#39;rnorm&#39;, 0.05602931158519976), (&#39;rnorm100&#39;, 5.602931158519977)]) OrderedDict([(&#39;sharperatio&#39;, None)]) ************************************************** -- {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 15, &#39;smac.slow_period&#39;: 40, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 80, &#39;rsi.rsi_lower&#39;: 20} OrderedDict([(&#39;rtot&#39;, 0.022474520295117782), (&#39;ravg&#39;, 9.248773783999087e-05), (&#39;rnorm&#39;, 0.02358063841261683), (&#39;rnorm100&#39;, 2.358063841261683)]) OrderedDict([(&#39;sharperatio&#39;, None)]) ************************************************** -- {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 15, &#39;smac.slow_period&#39;: 40, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 70, &#39;rsi.rsi_lower&#39;: 30} OrderedDict([(&#39;rtot&#39;, 0.2740679696753637), (&#39;ravg&#39;, 0.0011278517270591098), (&#39;rnorm&#39;, 0.3287234047301618), (&#39;rnorm100&#39;, 32.87234047301618)]) OrderedDict([(&#39;sharperatio&#39;, None)]) ************************************************** -- {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 15, &#39;smac.slow_period&#39;: 40, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 80, &#39;rsi.rsi_lower&#39;: 30} OrderedDict([(&#39;rtot&#39;, 0.23668767417980946), (&#39;ravg&#39;, 0.0009740233505341953), (&#39;rnorm&#39;, 0.2782013371264516), (&#39;rnorm100&#39;, 27.820133712645163)]) OrderedDict([(&#39;sharperatio&#39;, None)]) ************************************************** -- {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 15, &#39;smac.slow_period&#39;: 60, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 70, &#39;rsi.rsi_lower&#39;: 20} OrderedDict([(&#39;rtot&#39;, -0.04029774133997106), (&#39;ravg&#39;, -0.00016583432650193853), (&#39;rnorm&#39;, -0.04092907566388783), (&#39;rnorm100&#39;, -4.092907566388783)]) OrderedDict([(&#39;sharperatio&#39;, None)]) ************************************************** -- {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 15, &#39;smac.slow_period&#39;: 60, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 80, &#39;rsi.rsi_lower&#39;: 20} OrderedDict([(&#39;rtot&#39;, -0.07039597323112812), (&#39;ravg&#39;, -0.00028969536309106223), (&#39;rnorm&#39;, -0.07040217397345756), (&#39;rnorm100&#39;, -7.0402173973457565)]) OrderedDict([(&#39;sharperatio&#39;, None)]) ************************************************** -- {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 15, &#39;smac.slow_period&#39;: 60, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 70, &#39;rsi.rsi_lower&#39;: 30} OrderedDict([(&#39;rtot&#39;, 0.18109043677660316), (&#39;ravg&#39;, 0.0007452281348831406), (&#39;rnorm&#39;, 0.20658914422764327), (&#39;rnorm100&#39;, 20.658914422764326)]) OrderedDict([(&#39;sharperatio&#39;, None)]) ************************************************** -- {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 15, &#39;smac.slow_period&#39;: 60, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 80, &#39;rsi.rsi_lower&#39;: 30} OrderedDict([(&#39;rtot&#39;, 0.15624951145271396), (&#39;ravg&#39;, 0.0006430021047436788), (&#39;rnorm&#39;, 0.1759031967451431), (&#39;rnorm100&#39;, 17.59031967451431)]) OrderedDict([(&#39;sharperatio&#39;, None)]) Time used (seconds): 0.9437069892883301 Optimal parameters: {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;smac.fast_period&#39;: 15, &#39;smac.slow_period&#39;: 40, &#39;rsi.rsi_period&#39;: 14, &#39;rsi.rsi_upper&#39;: 70, &#39;rsi.rsi_lower&#39;: 30} Optimal metrics: {&#39;rtot&#39;: 0.2740679696753637, &#39;ravg&#39;: 0.0011278517270591098, &#39;rnorm&#39;: 0.3287234047301618, &#39;rnorm100&#39;: 32.87234047301618, &#39;sharperatio&#39;: None, &#39;pnl&#39;: 31530.42, &#39;final_value&#39;: 131530.42} . (16, 16) . res_opt . init_cash buy_prop sell_prop execution_type smac.fast_period smac.slow_period rsi.rsi_period rsi.rsi_upper rsi.rsi_lower rtot ravg rnorm rnorm100 sharperatio pnl final_value . 0 100000 | 1 | 1 | close | 15 | 40 | 14 | 70 | 30 | 0.274068 | 0.001128 | 0.328723 | 32.872340 | None | 31530.42 | 131530.4200 | . 1 100000 | 1 | 1 | close | 15 | 40 | 14 | 80 | 30 | 0.236688 | 0.000974 | 0.278201 | 27.820134 | None | 26704.53 | 126704.5325 | . 2 100000 | 1 | 1 | close | 10 | 40 | 14 | 70 | 30 | 0.205037 | 0.000844 | 0.236928 | 23.692777 | None | 22757.02 | 122757.0175 | . 3 100000 | 1 | 1 | close | 10 | 40 | 14 | 80 | 30 | 0.193423 | 0.000796 | 0.222120 | 22.211957 | None | 21339.58 | 121339.5825 | . 4 100000 | 1 | 1 | close | 15 | 60 | 14 | 70 | 30 | 0.181090 | 0.000745 | 0.206589 | 20.658914 | None | 19852.36 | 119852.3565 | . 5 100000 | 1 | 1 | close | 15 | 60 | 14 | 80 | 30 | 0.156250 | 0.000643 | 0.175903 | 17.590320 | None | 16911.79 | 116911.7875 | . 6 100000 | 1 | 1 | close | 10 | 60 | 14 | 70 | 30 | 0.119834 | 0.000493 | 0.132324 | 13.232438 | None | 12730.99 | 112730.9915 | . 7 100000 | 1 | 1 | close | 10 | 60 | 14 | 80 | 30 | 0.107638 | 0.000443 | 0.118093 | 11.809295 | None | 11364.44 | 111364.4450 | . 8 100000 | 1 | 1 | close | 15 | 40 | 14 | 70 | 20 | 0.052569 | 0.000216 | 0.056029 | 5.602931 | None | 5397.52 | 105397.5225 | . 9 100000 | 1 | 1 | close | 10 | 40 | 14 | 70 | 20 | 0.042377 | 0.000174 | 0.044927 | 4.492681 | None | 4328.80 | 104328.8050 | . 10 100000 | 1 | 1 | close | 15 | 40 | 14 | 80 | 20 | 0.022475 | 0.000092 | 0.023581 | 2.358064 | None | 2272.90 | 102272.8975 | . 11 100000 | 1 | 1 | close | 10 | 40 | 14 | 80 | 20 | 0.012323 | 0.000051 | 0.012861 | 1.286106 | None | 1239.89 | 101239.8900 | . 12 100000 | 1 | 1 | close | 15 | 60 | 14 | 70 | 20 | -0.040298 | -0.000166 | -0.040929 | -4.092908 | None | -3949.66 | 96050.3415 | . 13 100000 | 1 | 1 | close | 15 | 60 | 14 | 80 | 20 | -0.070396 | -0.000290 | -0.070402 | -7.040217 | None | -6797.53 | 93202.4690 | . 14 100000 | 1 | 1 | close | 10 | 60 | 14 | 70 | 20 | -0.096415 | -0.000397 | -0.095150 | -9.515003 | None | -9191.31 | 90808.6900 | . 15 100000 | 1 | 1 | close | 10 | 60 | 14 | 80 | 20 | -0.126454 | -0.000520 | -0.122902 | -12.290236 | None | -11878.49 | 88121.5125 | .",
            "url": "https://enzoampil.github.io/fastquant-blog/backtest/grid%20search/multi-strat/2020/05/10/backtest_multi_strategy.html",
            "relUrl": "/backtest/grid%20search/multi-strat/2020/05/10/backtest_multi_strategy.html",
            "date": " • May 10, 2020"
        }
        
    
  
    
        ,"post4": {
            "title": "Backtesting with grid search",
            "content": "# uncomment to install in colab # !pip3 install fastquant . backtest SMAC . fastquant offers a convenient way to backtest several trading strategies. To backtest using Simple Moving Average Crossover (SMAC), we do the following. . backtest(&#39;smac&#39;, dcv_data, fast_period=15, slow_period=40) . fast_period and slow_period are two SMAC parameters that can be changed depending on the user&#39;s preferences. A simple way to fine tune these parameters is to run backtest on a grid of values and find which combination of fast_period and slow_period yields the highest net profit. . First, we fetch JFC&#39;s historical data comprised of date, close price, and volume. . from fastquant import get_stock_data, backtest symbol=&#39;JFC&#39; dcv_data = get_stock_data(symbol, start_date=&#39;2018-01-01&#39;, end_date=&#39;2020-04-28&#39;, format=&#39;cv&#39;, ) dcv_data.head() . 849it [04:08, 4.04it/s] . close volume . dt . 2018-01-03 255.4 | 745780 | . 2018-01-04 255.0 | 617010 | . 2018-01-05 255.0 | 946040 | . 2018-01-08 256.0 | 840630 | . 2018-01-09 255.8 | 978180 | . import matplotlib.pyplot as pl pl.style.use(&quot;default&quot;) . from fastquant import backtest results = backtest(&quot;smac&quot;, dcv_data, fast_period=15, slow_period=40, verbose=False, plot=True ) . ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 15 slow_period : 40 Final PnL: -31257.65 Time used (seconds): 0.10944700241088867 Optimal parameters: {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;fast_period&#39;: 15, &#39;slow_period&#39;: 40} Optimal metrics: {&#39;rtot&#39;: -0.37480465562458976, &#39;ravg&#39;: -0.0006645472617457265, &#39;rnorm&#39;: -0.15419454966091925, &#39;rnorm100&#39;: -15.419454966091925, &#39;sharperatio&#39;: -0.9821454406209409, &#39;pnl&#39;: -31257.65, &#39;final_value&#39;: 68742.35499999995} . The plot above is optional. backtest returns a dataframe of parameters and corresponding metrics: . results.head() . init_cash buy_prop sell_prop execution_type fast_period slow_period rtot ravg rnorm rnorm100 sharperatio pnl final_value . 0 100000 | 1 | 1 | close | 15 | 40 | -0.374805 | -0.000665 | -0.154195 | -15.419455 | -0.982145 | -31257.65 | 68742.355 | . define the search space . Second, we specify the range of reasonable values to explore for fast_period and slow_period. Let&#39;s take between 1 and 20 trading days (roughly a month) in steps of 1 day for fast_period, and between 21 and 240 trading days (roughly a year) in steps of 5 days for slow_period. . import numpy as np fast_periods = np.arange(1,20,1, dtype=int) slow_periods = np.arange(20,241,5, dtype=int) # make a grid of 0&#39;s (placeholder) period_grid = np.zeros(shape=(len(fast_periods),len(slow_periods))) period_grid.shape . (19, 45) . run grid search . Third, we run backtest for each iteration over each pair of fast_period and slow_period, saving each time the net profit to the period_grid variable. . Note: Before running backtest over a large grid, try measuring how long it takes your machine to run one backtest instance. . %timeit backtest(...) . In my machine with 8 cores, backtest takes . 101 ms ± 8.3 ms per loop (mean ± std. dev. of 7 runs, 10 loops each) . from time import time init_cash=100000 start_time = time() for i,fast_period in enumerate(fast_periods): for j,slow_period in enumerate(slow_periods): results = backtest(&#39;smac&#39;, dcv_data, fast_period=fast_period, slow_period=slow_period, init_cash=100000, verbose=False, plot=False ) net_profit = results.final_value.values[0]-init_cash period_grid[i,j] = net_profit end_time = time() . time_basic = end_time-start_time print(&quot;Basic grid search took {:.1f} sec&quot;.format(time_basic)) . Basic grid search took 100.4 sec . visualize the period grid . Next, we visualize period_grid as a 2D matrix. . import matplotlib.colors as mcolors import matplotlib.pyplot as pl pl.style.use(&quot;default&quot;) fig, ax = pl.subplots(1,1, figsize=(8,4)) xmin, xmax = slow_periods[0],slow_periods[-1] ymin, ymax = fast_periods[0],fast_periods[-1] #make a diverging color map such that profit&lt;0 is red and blue otherwise cmap = pl.get_cmap(&#39;RdBu&#39;) norm = mcolors.DivergingNorm(vmin=period_grid.min(), vmax = period_grid.max(), vcenter=0 ) #plot matrix cbar = ax.imshow(period_grid, origin=&#39;lower&#39;, interpolation=&#39;none&#39;, extent=[xmin, xmax, ymin, ymax], cmap=cmap, norm=norm ) pl.colorbar(cbar, ax=ax, shrink=0.9, label=&#39;net profit&#39;, orientation=&quot;horizontal&quot;) # search position with highest net profit y, x = np.unravel_index(np.argmax(period_grid), period_grid.shape) best_slow_period = slow_periods[x] best_fast_period = fast_periods[y] # mark position # ax.annotate(f&quot;max profit={period_grid[y, x]:.0f}@({best_slow_period}, {best_fast_period}) days&quot;, # (best_slow_period+5,best_fast_period+1) # ) ax.axvline(best_slow_period, 0, 1, c=&#39;k&#39;, ls=&#39;--&#39;) ax.axhline(best_fast_period+0.5, 0, 1, c=&#39;k&#39;, ls=&#39;--&#39;) # add labels ax.set_aspect(5) pl.setp(ax, xlim=(xmin,xmax), ylim=(ymin,ymax), xlabel=&#39;slow period (days)&#39;, ylabel=&#39;fast period (days)&#39;, title=&#39;JFC w/ SMAC&#39;, ); . print(f&quot;max profit={period_grid[y, x]:.0f} @ ({best_slow_period},{best_fast_period}) days&quot;) . max profit=7042 @ (105,3) days . From the plot above, there are only a few period combinations which we can guarantee non-negative net profit using SMAC strategy. The best result is achieved with (105,30) for period_slow and period_fast, respectively. . In fact SMAC strategy is so bad such that there is only 9% chance it will yield profit when using any random period combinations in our grid, which is smaller than the 12% chance it will yield break even at least. . percent_positive_profit=(period_grid&gt;0).sum()/np.product(period_grid.shape)*100 percent_positive_profit . 9.005847953216374 . percent_breakeven=(period_grid==0).sum()/np.product(period_grid.shape)*100 percent_breakeven . 12.397660818713451 . Anyway, let&#39;s check the results of backtest using the best_fast_period and best_slow_period. . results = backtest(&#39;smac&#39;, dcv_data, fast_period=best_fast_period, slow_period=best_slow_period, verbose=True, plot=True ) net_profit = results.final_value.values[0]-init_cash net_profit . Starting Portfolio Value: 100000.00 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 3 slow_period : 105 2018-08-22, BUY CREATE, 286.00 2018-08-22, Cash: 100000.0 2018-08-22, Price: 286.0 2018-08-22, Buy prop size: 346 2018-08-22, Afforded size: 346 2018-08-22, Final size: 346 2018-08-23, BUY EXECUTED, Price: 286.00, Cost: 98956.00, Comm 742.17 2018-09-12, SELL CREATE, 277.00 2018-09-13, SELL EXECUTED, Price: 277.00, Cost: 98956.00, Comm 718.81 2018-09-13, OPERATION PROFIT, GROSS -3114.00, NET -4574.98 2018-10-23, BUY CREATE, 268.00 2018-10-23, Cash: 95425.015 2018-10-23, Price: 268.0 2018-10-23, Buy prop size: 353 2018-10-23, Afforded size: 353 2018-10-23, Final size: 353 2018-10-24, BUY EXECUTED, Price: 268.00, Cost: 94604.00, Comm 709.53 2018-10-25, SELL CREATE, 270.00 2018-10-26, SELL EXECUTED, Price: 270.00, Cost: 94604.00, Comm 714.83 2018-10-26, OPERATION PROFIT, GROSS 706.00, NET -718.36 2018-10-30, BUY CREATE, 264.00 2018-10-30, Cash: 94706.66 2018-10-30, Price: 264.0 2018-10-30, Buy prop size: 355 2018-10-30, Afforded size: 355 2018-10-30, Final size: 355 2018-10-31, BUY EXECUTED, Price: 264.00, Cost: 93720.00, Comm 702.90 2019-04-17, SELL CREATE, 303.00 2019-04-22, SELL EXECUTED, Price: 303.00, Cost: 93720.00, Comm 806.74 2019-04-22, OPERATION PROFIT, GROSS 13845.00, NET 12335.36 Final PnL: 7042.02 ================================================== ************************************************** -- {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;fast_period&#39;: 3, &#39;slow_period&#39;: 105} OrderedDict([(&#39;rtot&#39;, 0.06805130501900258), (&#39;ravg&#39;, 0.00012065834223227409), (&#39;rnorm&#39;, 0.03087288265827186), (&#39;rnorm100&#39;, 3.087288265827186)]) OrderedDict([(&#39;sharperatio&#39;, 0.7850452330792583)]) Time used (seconds): 0.11643362045288086 Optimal parameters: {&#39;init_cash&#39;: 100000, &#39;buy_prop&#39;: 1, &#39;sell_prop&#39;: 1, &#39;execution_type&#39;: &#39;close&#39;, &#39;fast_period&#39;: 3, &#39;slow_period&#39;: 105} Optimal metrics: {&#39;rtot&#39;: 0.06805130501900258, &#39;ravg&#39;: 0.00012065834223227409, &#39;rnorm&#39;: 0.03087288265827186, &#39;rnorm100&#39;: 3.087288265827186, &#39;sharperatio&#39;: 0.7850452330792583, &#39;pnl&#39;: 7042.02, &#39;final_value&#39;: 107042.0225} . 7042.022500000006 . There are only 6 cross-over events of which only the latest transaction yielded positive gains resulting to a 7% net profit. Is 7% profit over a ~two-year baseline better than the market benchmark? . built-in grid search in fastquant . The good news is backtest provides a built-in grid search if strategy parameters are lists. Let&#39;s re-run backtest with a grid we used above. . from fastquant import backtest start_time = time() results = backtest(&quot;smac&quot;, dcv_data, fast_period=fast_periods, slow_period=slow_periods, verbose=False, plot=False ) end_time = time() time_optimized = end_time-start_time . print(&quot;Optimized grid search took {:.1f} sec&quot;.format(time_optimized)) . Optimized grid search took 95.6 sec . results is automatically ranked based on rnorm which is a proxy for performance. In this case, the best fast_period,slow_period=(8,200) d. . The returned parameters are should have len(fast_periods)xlen(slow_periods) (19x45=855 in this case). . results.shape . (855, 13) . results.head() . init_cash buy_prop sell_prop execution_type fast_period slow_period rtot ravg rnorm rnorm100 sharperatio pnl final_value . 0 100000 | 1 | 1 | close | 3 | 105 | 0.068051 | 0.000121 | 0.030873 | 3.087288 | 0.785045 | 7042.02 | 107042.0225 | . 1 100000 | 1 | 1 | close | 8 | 205 | 0.037052 | 0.000066 | 0.016693 | 1.669276 | 0.085703 | 3774.66 | 103774.6555 | . 2 100000 | 1 | 1 | close | 11 | 170 | 0.037052 | 0.000066 | 0.016693 | 1.669276 | 0.085703 | 3774.66 | 103774.6555 | . 3 100000 | 1 | 1 | close | 8 | 200 | 0.037052 | 0.000066 | 0.016693 | 1.669276 | 0.085703 | 3774.66 | 103774.6555 | . 4 100000 | 1 | 1 | close | 9 | 95 | 0.033320 | 0.000059 | 0.014999 | 1.499897 | 0.092115 | 3388.12 | 103388.1175 | . Now, we recreate the 2D matrix before, but this time using scatter plot. . fig, ax = pl.subplots(1,1, figsize=(8,4)) #make a diverging color map such that profit&lt;0 is red and blue otherwise cmap = pl.get_cmap(&#39;RdBu&#39;) norm = mcolors.DivergingNorm(vmin=period_grid.min(), vmax = period_grid.max(), vcenter=0 ) #plot scatter results[&#39;net_profit&#39;] = results[&#39;final_value&#39;]-results[&#39;init_cash&#39;] df = results[[&#39;slow_period&#39;,&#39;fast_period&#39;,&#39;net_profit&#39;]] ax2 = df.plot.scatter(x=&#39;slow_period&#39;, y=&#39;fast_period&#39;, c=&#39;net_profit&#39;, norm=norm, cmap=cmap, ax=ax ) ymin,ymax = df.fast_period.min(), df.fast_period.max() xmin,xmax = df.slow_period.min(), df.slow_period.max() # best performance (instead of highest profit) best_fast_period, best_slow_period, net_profit = df.loc[0,[&#39;fast_period&#39;,&#39;slow_period&#39;,&#39;net_profit&#39;]] # mark position # ax.annotate(f&quot;max profit={net_profit:.0f}@({best_slow_period}, {best_fast_period}) days&quot;, # (best_slow_period-100,best_fast_period+1), color=&#39;r&#39; # ) ax.axvline(best_slow_period, 0, 1, c=&#39;r&#39;, ls=&#39;--&#39;) ax.axhline(best_fast_period+0.5, 0, 1, c=&#39;r&#39;, ls=&#39;--&#39;) ax.set_aspect(5) pl.setp(ax, xlim=(xmin,xmax), ylim=(ymin,ymax), xlabel=&#39;slow period (days)&#39;, ylabel=&#39;fast period (days)&#39;, title=&#39;JFC w/ SMAC&#39;, ); # fig.colorbar(ax2, orientation=&quot;horizontal&quot;, shrink=0.9, label=&#39;net profit&#39;) . print(f&quot;max profit={net_profit:.0f} @ ({best_slow_period},{best_fast_period}) days&quot;) . max profit=7042 @ (105.0,3.0) days . Note also that built-in grid search in backtest is optimized and slightly faster than the basic loop-based grid search. . #time time_basic/time_optimized . 1.0497938879462785 . Final notes . While it is tempting to do a grid search over larger search space and finer resolutions, it is computationally expensive, inefficient, and prone to overfitting. There are better methods than brute force grid search which we will tackle in the next example. . As an exercise, it is good to try the following: . Use different trading strategies and compare their results | Use a longer data baseline | .",
            "url": "https://enzoampil.github.io/fastquant-blog/grid%20search/backtest/2020/04/20/backtest_with_grid_search.html",
            "relUrl": "/grid%20search/backtest/2020/04/20/backtest_with_grid_search.html",
            "date": " • Apr 20, 2020"
        }
        
    
  
    
        ,"post5": {
            "title": "Analyzing PSE disclosures data",
            "content": "# uncomment to install in colab # !pip install -e git+https://github.com/enzoampil/fastquant.git@master#egg=fastquant . from fastquant import DisclosuresPSE . fetching company disclosures . dpse = DisclosuresPSE(symbol=&#39;JFC&#39;, start_date=&#39;1-1-2020&#39;, end_date=&#39;5-1-2020&#39; ) . Pulling JFC disclosures summary... . 0%| | 0/12 [00:00&lt;?, ?it/s] . 1 pages detected! Found 12 disclosures between 1-1-2020 &amp; 5-1-2020 with 4 types: [&#39;Press Release&#39; &#39;Declaration of Cash Dividends&#39; &#39;Material Information/Transactions&#39; &#39;Joint Ventures&#39;] Pulling details in all JFC disclosures... . 100%|██████████| 12/12 [00:09&lt;00:00, 1.21it/s] . Saved: /home/prometheus/github/research/project/fastquant/python/fastquant/data/JFC_disclosures_1-1-2020_5-1-2020.csv . . dpse . DisclosuresPSE(&#39;JFC&#39;, &#39;all&#39;, &#39;1-1-2020&#39;, &#39;5-1-2020&#39;, True, False) . # summary of each disclosure dpse.company_disclosures.head() . Company Name Template Name PSE Form Number Announce Date and Time Circular Number edge_no url . 0 Jollibee Foods Corporation | Press Release | 4-31 | 2020-04-15 07:41:00 | C02771-2020 | 2fd88ba354823b280de8473cebbd6407 | https://edge.pse.com.ph/openDiscViewer.do?edge... | . 1 Jollibee Foods Corporation | Declaration of Cash Dividends | 6-1 | 2020-04-07 10:16:00 | C02610-2020 | 4b9121b34dd8b8e80de8473cebbd6407 | https://edge.pse.com.ph/openDiscViewer.do?edge... | . 2 Jollibee Foods Corporation | Press Release | 4-31 | 2020-03-20 07:16:00 | C02127-2020 | a5df62b1a9558fe60de8473cebbd6407 | https://edge.pse.com.ph/openDiscViewer.do?edge... | . 3 Jollibee Foods Corporation | Press Release | 4-31 | 2020-03-19 07:31:00 | C02092-2020 | 6a7705d00b3e6fb50de8473cebbd6407 | https://edge.pse.com.ph/openDiscViewer.do?edge... | . 4 Jollibee Foods Corporation | Material Information/Transactions | 4-30 | 2020-03-16 12:49:00 | C01925-2020 | 5b6a51f239ad5a6f0de8473cebbd6407 | https://edge.pse.com.ph/openDiscViewer.do?edge... | . # includes details dpse.disclosures_combined.head() . Company Name Template Name PSE Form Number Announce Date and Time Circular Number edge_no url disclosure_table Background/Description of the Disclosure Subject of the Disclosure . 0 Jollibee Foods Corporation | Press Release | 4-31 | 2020-04-15 07:41:00 | C02771-2020 | 2fd88ba354823b280de8473cebbd6407 | https://edge.pse.com.ph/openDiscViewer.do?edge... | {&quot;Title of Each Class&quot;: &quot;Common&quot;, &quot;Subject of ... | JFC Reports 2019 Results Based on Audited Fina... | Press Release: 2019 Audited Financial Results | . 1 Jollibee Foods Corporation | Declaration of Cash Dividends | 6-1 | 2020-04-07 10:16:00 | C02610-2020 | 4b9121b34dd8b8e80de8473cebbd6407 | https://edge.pse.com.ph/openDiscViewer.do?edge... | {&quot;Title of Each Class&quot;: &quot;Common&quot;, &quot;Subject of ... | Jollibee Foods Corporation (JFC) announced tod... | JFC Declares Cash Dividend, Delivery Business ... | . 2 Jollibee Foods Corporation | Press Release | 4-31 | 2020-03-20 07:16:00 | C02127-2020 | a5df62b1a9558fe60de8473cebbd6407 | https://edge.pse.com.ph/openDiscViewer.do?edge... | {&quot;Title of Each Class&quot;: &quot;Common&quot;, &quot;Subject of ... | Jollibee Foods Corporation (JFC) Chairman and ... | Jollibee Group allocates Php1 Billion Emergenc... | . 3 Jollibee Foods Corporation | Press Release | 4-31 | 2020-03-19 07:31:00 | C02092-2020 | 6a7705d00b3e6fb50de8473cebbd6407 | https://edge.pse.com.ph/openDiscViewer.do?edge... | {&quot;Title of Each Class&quot;: &quot;Common&quot;, &quot;Subject of ... | In support of health workers and other frontli... | Jollibee Group Donates Php 100 Million worth o... | . 4 Jollibee Foods Corporation | Material Information/Transactions | 4-30 | 2020-03-16 12:49:00 | C01925-2020 | 5b6a51f239ad5a6f0de8473cebbd6407 | https://edge.pse.com.ph/openDiscViewer.do?edge... | {&quot;Title of Each Class&quot;: &quot;Common&quot;, &quot;Subject of ... | This provides a brief summary for Jollibee Foo... | Risks, Impact on the Business and Mitigation M... | . #get details in each disclosure given edge_no dpse.disclosure_tables[&#39;a5df62b1a9558fe60de8473cebbd6407&#39;].shape . (6, 2) . dpse.disclosures_combined[&#39;Subject of the Disclosure&#39;] . 0 Press Release: 2019 Audited Financial Results 1 JFC Declares Cash Dividend, Delivery Business ... 2 Jollibee Group allocates Php1 Billion Emergenc... 3 Jollibee Group Donates Php 100 Million worth o... 4 Risks, Impact on the Business and Mitigation M... 5 Jollibee Foods Corporation (JFC) and Dim Sum P... 6 Results of the 4th Quarter Unaudited Financial... 7 Press Release: 2019 4th Quarter Financial Results 8 JFC Provides Statement on Business in China 9 JFC to Issue US$600 Million Guaranteed Senior ... 10 JFC to Issue US$600 Million Guaranteed Senior ... 11 JFC Mandates Banks for U.S.$ Senior Guaranteed... Name: Subject of the Disclosure, dtype: object . dpse.disclosures_combined[&#39;Background/Description of the Disclosure&#39;] . 0 JFC Reports 2019 Results Based on Audited Fina... 1 Jollibee Foods Corporation (JFC) announced tod... 2 Jollibee Foods Corporation (JFC) Chairman and ... 3 In support of health workers and other frontli... 4 This provides a brief summary for Jollibee Foo... 5 Golden Plate Pte. Ltd. (GPPL), a wholly owned ... 6 4th Quarter Unaudited Financial Statements for... 7 JFC Same Store Sales Growth Improves, Gains fr... 8 Jollibee Foods Corporation makes the following... 9 Jollibee Foods Corporation (JFC, the “Guaranto... 10 Jollibee Foods Corporation (JFC, the “Guaranto... 11 Jollibee Worldwide Pte. Ltd. (JWPL, the “Issue... Name: Background/Description of the Disclosure, dtype: object . visualization . dpse.disclosure_types . array([&#39;Press Release&#39;, &#39;Declaration of Cash Dividends&#39;, &#39;Material Information/Transactions&#39;, &#39;Joint Ventures&#39;], dtype=object) . #all disclosures superposed with percent change fig = dpse.plot_disclosures() . Pulling JFC stock data... . #all disclosures superposed with close price fig = dpse.plot_disclosures(indicator=&#39;close&#39;, diff=False, percent=False) . filtering disclosures . #disclosures co-incident with max percent change maximum = dpse.filter_disclosures() maximum . Company Name Template Name PSE Form Number Announce Date and Time Circular Number edge_no url disclosure_table Background/Description of the Disclosure Subject of the Disclosure . 5 Jollibee Foods Corporation | [Amend-1]Joint Ventures | 4-22 | 2020-03-13 15:49:00 | C01685-2020 | 21b9a26e7aa00f960de8473cebbd6407 | https://edge.pse.com.ph/openDiscViewer.do?edge... | {&quot;Title of Each Class&quot;: &quot;COMMON&quot;, &quot;Subject of ... | Golden Plate Pte. Ltd. (GPPL), a wholly owned ... | Jollibee Foods Corporation (JFC) and Dim Sum P... | . #disclosures co-incident with min percent change minimum = dpse.filter_disclosures(operation=&#39;min&#39;) minimum . Company Name Template Name PSE Form Number Announce Date and Time Circular Number edge_no url disclosure_table Background/Description of the Disclosure Subject of the Disclosure . 0 Jollibee Foods Corporation | Press Release | 4-31 | 2020-04-15 07:41:00 | C02771-2020 | 2fd88ba354823b280de8473cebbd6407 | https://edge.pse.com.ph/openDiscViewer.do?edge... | {&quot;Title of Each Class&quot;: &quot;Common&quot;, &quot;Subject of ... | JFC Reports 2019 Results Based on Audited Fina... | Press Release: 2019 Audited Financial Results | . #what happened then? maximum[&#39;Background/Description of the Disclosure&#39;].values . array([&#39;Golden Plate Pte. Ltd. (GPPL), a wholly owned subsidiary of JFC, and DSPL executed a Joint Venture Agreement to establish a joint venture company (the “JV”) to be incorporated in the People’s Republic of China (PRC). The JV shall sign a Unit Franchise Agreement with Tim Ho Wan Pte. Ltd. (“Franchisor”), authorized master franchisor of Tim Ho Wan in the Asia-Pacific, to develop and operate Tim Ho Wan stores in Shanghai and such other cities within the PRC as may be agreed with the Franchisor.&#39;], dtype=object) . #details maximum[&#39;Subject of the Disclosure&#39;].values . array([&#39;Jollibee Foods Corporation (JFC) and Dim Sum Pte. Ltd. (DSPL) Signs Agreement to Expand and Operate the Tim Ho Wan Brand in China.&#39;], dtype=object) . #get url maximum[&#39;url&#39;].values . array([&#39;https://edge.pse.com.ph/openDiscViewer.do?edge_no=21b9a26e7aa00f960de8473cebbd6407&#39;], dtype=object) . #what happened during minimum? minimum[&#39;Background/Description of the Disclosure&#39;].values . array([&#39;JFC Reports 2019 Results Based on Audited Financial Statements&#39;], dtype=object) . #details minimum[&#39;Subject of the Disclosure&#39;].values . array([&#39;Press Release: 2019 Audited Financial Results&#39;], dtype=object) . #get url minimum[&#39;url&#39;].values . array([&#39;https://edge.pse.com.ph/openDiscViewer.do?edge_no=2fd88ba354823b280de8473cebbd6407&#39;], dtype=object) . Investagrams disclosures . from fastquant import DisclosuresInvestagrams . dinv = DisclosuresInvestagrams(symbol=&#39;JFC&#39;, from_date=&#39;2018-01-01&#39;, to_date=&#39;2020-04-01&#39;) . dinv.dividends . id time color label Cash Dividends Ex-Date Record Date Payment Date . 0 timediv607 | 2018-04-19 | #0496FF | D | 1.14 | Thu Apr 19, 2018 | Tue Apr 24, 2018 | Wed May 09, 2018 | . 1 timediv786 | 2018-11-21 | #0496FF | D | 1.34 | Wed Nov 21, 2018 | Mon Nov 26, 2018 | Mon Dec 10, 2018 | . 2 timediv934 | 2019-04-23 | #0496FF | D | 1.23 | Tue Apr 23, 2019 | Fri Apr 26, 2019 | Thu May 09, 2019 | . 3 timediv1112 | 2019-11-21 | #0496FF | D | 1.35 | Thu Nov 21, 2019 | Tue Nov 26, 2019 | Tue Dec 10, 2019 | . dinv.earnings . id time color label Total Revenue Net Income EPS Date Period Ending Revenue Unit NI Unit Net Income Amount Net Income YoY Growth (%) . 0 timeearnings4820175 | 2018-04-11 06:26:00 | #DC143C | E | 133.39 | 6.67B (10.23%) | 6.58 | Wed Apr 11, 2018 | Dec 31, 2017 | B | B (%) | 6.67 | 10.23 | . 1 timeearnings4820181 | 2018-05-10 00:32:00 | #DC143C | E | 35.05 | 1.67B (13.14%) | 1.66 | Thu May 10, 2018 | Mar 31, 2018 | B | B (%) | 1.67 | 13.14 | . 2 timeearnings4820182 | 2018-08-14 01:21:00 | #DC143C | E | 40.78 | 2.1B (10.55%) | 2.07 | Tue Aug 14, 2018 | Jun 30, 2018 | B | B (%) | 2.10 | 10.55 | . 3 timeearnings4820183 | 2018-11-12 05:18:00 | #DC143C | E | 40.49 | 1.93B (26.90%) | 1.87 | Mon Nov 12, 2018 | Sep 30, 2018 | B | B (%) | 1.93 | 26.90 | . 4 timeearnings4820185 | 2019-04-11 00:33:00 | #DC143C | E | 164.35 | 7.77B (16.47%) | 7.66 | Thu Apr 11, 2019 | Dec 31, 2018 | B | B (%) | 7.77 | 16.47 | . 5 timeearnings4820191 | 2019-05-15 06:37:00 | #DC143C | E | 40.62 | 1.43B (-14.06%) | 1.41 | Wed May 15, 2019 | Mar 31, 2019 | B | B (-%) | 1.43 | -14.06 | . 6 timeearnings4820192 | 2019-08-05 07:13:00 | #DC143C | E | 44.22 | 985.48M (-53.10%) | 1.03 | Mon Aug 05, 2019 | Jun 30, 2019 | B | M (-%) | 985.48 | -53.10 | . 7 timeearnings4820193 | 2019-11-14 03:46:00 | #DC143C | E | 45.17 | 2.01B (4.48%) | 1.71 | Thu Nov 14, 2019 | Sep 30, 2019 | B | B (%) | 2.01 | 4.48 | .",
            "url": "https://enzoampil.github.io/fastquant-blog/disclosures/2020/04/10/disclosures.html",
            "relUrl": "/disclosures/2020/04/10/disclosures.html",
            "date": " • Apr 10, 2020"
        }
        
    
  
    
        ,"post6": {
            "title": "Lesson 2: Backtest your trading strategy with only 3 lines of code",
            "content": "#!pip install fastquant . /Users/enzoampil/quant/fastquant . fastquant Lesson 2 - Backtest your trading strategy with only 3 lines of code . fastquant package Updates . get_stock_data has been added, which now includes all Yahoo Finance data (on top of PSE) | backtest function is now ready to use! | README has been updated to reflect the above | Setup . Google Colab (limitted plotting) | Jupyter notebook (complete plotting) | Google Colab Lesson 2 link . Colab notebook on this link . How to use Jupyter notebooks . 1. Go to your terminal and install jupyter . pip3 install jupyter . 2. Clone fastquant . git clone https://github.com/enzoampil/fastquant.git . cd fastquant . 3. Run jupyter . jupyter notebook . 4. Open lesson at lessons/fastquant_lesson2_backtest_your_trading_strategy.ipynb . Recap from Lesson 1 . Plot Closing Stock Prices . from matplotlib import pyplot as plt from fastquant import backtest, get_stock_data %matplotlib inline jfc = get_stock_data(&quot;JFC&quot;, &quot;2018-01-01&quot;, &quot;2019-01-01&quot;) jfc.close.plot(figsize=(10, 6)) plt.title(&quot;Daily Closing Prices of JFC nfrom 2018-01-01 to 2019-01-01&quot;, fontsize=20) . Reading cached file found: JFC_2018-01-01_2019-01-01.csv . Text(0.5, 1.0, &#39;Daily Closing Prices of JFC nfrom 2018-01-01 to 2019-01-01&#39;) . Analyze with a simple moving average (SMA) trading strategy . In this section, we will attempt to visually assess the performance of a SMA crossover strategy. There are many ways to do this strategy, but we will go with a “price crossover” approach with a 30 day SMA. . In this case, it’s considered a “buy” signal when the closing price crosses the simple moving average from below, and considered a “sell” signal when the closing price crosses the simple moving average from above. . So how do we know our SMA price crossover strategy is effective? Visually, we can assess this by seeing if the “sell” signal happens right before the stock price starts going down, and if the “buy” signal happens right before the stock price starts going up. . import pandas as pd ma30 = jfc.close.rolling(30).mean() close_ma30 = pd.concat([jfc.close, ma30], axis=1).dropna() close_ma30.columns = [&#39;Closing Price&#39;, &#39;Simple Moving Average (30 day)&#39;] close_ma30.plot(figsize=(10, 6)) plt.title(&quot;Daily Closing Prices vs 30 day SMA of JFC nfrom 2018-01-01 to 2019-01-01&quot;, fontsize=20) . Text(0.5, 1.0, &#39;Daily Closing Prices vs 30 day SMA of JFC nfrom 2018-01-01 to 2019-01-01&#39;) . Lesson 2: Backtesting with fastquant . Backtest your trading strategy in 3 lines of code . Now, let&#39;s get started with backtesting! . Below, I show how you can use fastquant to backtest a simple moving average crossover (similar to what we have above). . The three steps are: . Import the backtest and get_pse_data functions from fastquant | from fastquant import backtest, get_stock_data . Get stock data in a date, close, volume format (DCV) | Here, we get DCV (date, closing, volume) data from JFC using the get_pse_data function . jfc = get_stock_data(&quot;JFC&quot;, &quot;2018-01-01&quot;, &quot;2019-01-01&quot;) . Reading cached file found: JFC_2018-01-01_2019-01-01.csv . jfc . dt close volume . 0 2018-01-03 | 255.4 | 745780 | . 1 2018-01-04 | 255.0 | 617010 | . 2 2018-01-05 | 255.0 | 946040 | . 3 2018-01-08 | 256.0 | 840630 | . 4 2018-01-09 | 255.8 | 978180 | . ... ... | ... | ... | . 238 2018-12-20 | 303.0 | 659480 | . 239 2018-12-21 | 302.4 | 715510 | . 240 2018-12-26 | 292.0 | 1087620 | . 241 2018-12-27 | 295.0 | 585760 | . 242 2018-12-28 | 291.8 | 425440 | . 243 rows × 3 columns . Backtest a simple moving average crossover (smac) strategy on the JFC data | We perform the backtest using a 15 day moving average as the &quot;fast&quot; moving average, and a 35 day moving average as the &quot;slow&quot; moving average. If we want to change these parameter values, we can just replace the numbers in the backtest function. . We call these the strategy level arguments since they are unique to a specific strategy. . Do note that by default, the backtesting algorithm assumes that you start out with PHP 100,000 as cash (init_cash), while using all of that cash during a buy signal (buy_prop), and selling all of your current stock holdings during a sell signal (sell_prop). We call these the global level arguments since they can be shared across companies. . %matplotlib backtest(&#39;smac&#39;, jfc, fast_period=15, slow_period=35) . Using matplotlib backend: MacOSX Starting Portfolio Value: 100000.00 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 15 slow_period : 35 2018-08-06, BUY CREATE, 280.00 2018-08-06, Cash: 100000.0 2018-08-06, Price: 280.0 2018-08-06, Buy prop size: 354 2018-08-06, Afforded size: 354 2018-08-06, Final size: 354 2018-08-07, BUY EXECUTED, Price: 280.00, Cost: 99120.00, Comm 743.40 2018-09-20, SELL CREATE, 272.00 2018-09-21, SELL EXECUTED, Price: 272.00, Cost: 99120.00, Comm 722.16 2018-09-21, OPERATION PROFIT, GROSS -2832.00, NET -4297.56 2018-10-31, BUY CREATE, 276.00 2018-10-31, Cash: 95702.44 2018-10-31, Price: 276.0 2018-10-31, Buy prop size: 343 2018-10-31, Afforded size: 343 2018-10-31, Final size: 343 2018-11-05, BUY EXECUTED, Price: 276.00, Cost: 94668.00, Comm 710.01 Final Portfolio Value: 100411.83 . Customize strategy parameters . The idea of backtesting is that we should choose the best strategy based on which one has worked best over time. . %matplotlib backtest(&#39;smac&#39;, jfc, fast_period=1, slow_period=30) . Using matplotlib backend: MacOSX Starting Portfolio Value: 100000.00 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 1 slow_period : 30 2018-02-26, BUY CREATE, 292.00 2018-02-26, Cash: 100000.0 2018-02-26, Price: 292.0 2018-02-26, Buy prop size: 339 2018-02-26, Afforded size: 339 2018-02-26, Final size: 339 2018-02-27, BUY EXECUTED, Price: 292.00, Cost: 98988.00, Comm 742.41 2018-03-14, SELL CREATE, 284.00 2018-03-15, SELL EXECUTED, Price: 284.00, Cost: 98988.00, Comm 722.07 2018-03-15, OPERATION PROFIT, GROSS -2712.00, NET -4176.48 2018-03-16, BUY CREATE, 305.40 2018-03-16, Cash: 95823.51999999999 2018-03-16, Price: 305.4 2018-03-16, Buy prop size: 311 2018-03-16, Afforded size: 311 2018-03-16, Final size: 311 2018-03-19, BUY EXECUTED, Price: 305.40, Cost: 94979.40, Comm 712.35 2018-03-20, SELL CREATE, 285.00 2018-03-21, SELL EXECUTED, Price: 285.00, Cost: 94979.40, Comm 664.76 2018-03-21, OPERATION PROFIT, GROSS -6344.40, NET -7721.51 2018-03-26, BUY CREATE, 295.00 2018-03-26, Cash: 88102.012 2018-03-26, Price: 295.0 2018-03-26, Buy prop size: 296 2018-03-26, Afforded size: 296 2018-03-26, Final size: 296 2018-03-27, BUY EXECUTED, Price: 295.00, Cost: 87320.00, Comm 654.90 2018-04-04, SELL CREATE, 280.00 2018-04-05, SELL EXECUTED, Price: 280.00, Cost: 87320.00, Comm 621.60 2018-04-05, OPERATION PROFIT, GROSS -4440.00, NET -5716.50 2018-04-12, BUY CREATE, 300.00 2018-04-12, Cash: 82385.512 2018-04-12, Price: 300.0 2018-04-12, Buy prop size: 272 2018-04-12, Afforded size: 272 2018-04-12, Final size: 272 2018-04-13, BUY EXECUTED, Price: 300.00, Cost: 81600.00, Comm 612.00 2018-04-13, SELL CREATE, 291.60 2018-04-16, SELL EXECUTED, Price: 291.60, Cost: 81600.00, Comm 594.86 2018-04-16, OPERATION PROFIT, GROSS -2284.80, NET -3491.66 2018-04-18, BUY CREATE, 294.20 2018-04-18, Cash: 78893.84800000001 2018-04-18, Price: 294.2 2018-04-18, Buy prop size: 265 2018-04-18, Afforded size: 265 2018-04-18, Final size: 265 2018-04-19, BUY EXECUTED, Price: 294.20, Cost: 77963.00, Comm 584.72 2018-04-19, SELL CREATE, 291.00 2018-04-20, SELL EXECUTED, Price: 291.00, Cost: 77963.00, Comm 578.36 2018-04-20, OPERATION PROFIT, GROSS -848.00, NET -2011.08 2018-04-23, BUY CREATE, 294.00 2018-04-23, Cash: 76882.763 2018-04-23, Price: 294.0 2018-04-23, Buy prop size: 259 2018-04-23, Afforded size: 259 2018-04-23, Final size: 259 2018-04-24, BUY EXECUTED, Price: 294.00, Cost: 76146.00, Comm 571.09 2018-04-24, SELL CREATE, 281.60 2018-04-25, SELL EXECUTED, Price: 281.60, Cost: 76146.00, Comm 547.01 2018-04-25, OPERATION PROFIT, GROSS -3211.60, NET -4329.70 2018-05-16, BUY CREATE, 286.60 2018-05-16, Cash: 72553.06000000001 2018-05-16, Price: 286.6 2018-05-16, Buy prop size: 251 2018-05-16, Afforded size: 251 2018-05-16, Final size: 251 2018-05-17, BUY EXECUTED, Price: 286.60, Cost: 71936.60, Comm 539.52 2018-05-17, SELL CREATE, 285.00 2018-05-18, SELL EXECUTED, Price: 285.00, Cost: 71936.60, Comm 536.51 2018-05-18, OPERATION PROFIT, GROSS -401.60, NET -1477.64 2018-05-18, BUY CREATE, 285.00 2018-05-18, Cash: 71075.42300000001 2018-05-18, Price: 285.0 2018-05-18, Buy prop size: 247 2018-05-18, Afforded size: 247 2018-05-18, Final size: 247 2018-05-21, BUY EXECUTED, Price: 285.00, Cost: 70395.00, Comm 527.96 2018-05-21, SELL CREATE, 284.00 2018-05-22, SELL EXECUTED, Price: 284.00, Cost: 70395.00, Comm 526.11 2018-05-22, OPERATION PROFIT, GROSS -247.00, NET -1301.07 2018-05-23, BUY CREATE, 287.00 2018-05-23, Cash: 69774.35050000002 2018-05-23, Price: 287.0 2018-05-23, Buy prop size: 241 2018-05-23, Afforded size: 241 2018-05-23, Final size: 241 2018-05-24, BUY EXECUTED, Price: 287.00, Cost: 69167.00, Comm 518.75 2018-05-24, SELL CREATE, 281.20 2018-05-25, SELL EXECUTED, Price: 281.20, Cost: 69167.00, Comm 508.27 2018-05-25, OPERATION PROFIT, GROSS -1397.80, NET -2424.82 2018-06-01, BUY CREATE, 283.80 2018-06-01, Cash: 67349.52900000001 2018-06-01, Price: 283.8 2018-06-01, Buy prop size: 235 2018-06-01, Afforded size: 235 2018-06-01, Final size: 235 2018-06-04, BUY EXECUTED, Price: 283.80, Cost: 66693.00, Comm 500.20 2018-06-04, SELL CREATE, 280.20 2018-06-05, SELL EXECUTED, Price: 280.20, Cost: 66693.00, Comm 493.85 2018-06-05, OPERATION PROFIT, GROSS -846.00, NET -1840.05 2018-06-07, BUY CREATE, 282.60 2018-06-07, Cash: 65509.479000000014 2018-06-07, Price: 282.6 2018-06-07, Buy prop size: 229 2018-06-07, Afforded size: 229 2018-06-07, Final size: 229 2018-06-08, BUY EXECUTED, Price: 282.60, Cost: 64715.40, Comm 485.37 2018-06-13, SELL CREATE, 279.20 2018-06-14, SELL EXECUTED, Price: 279.20, Cost: 64715.40, Comm 479.53 2018-06-14, OPERATION PROFIT, GROSS -778.60, NET -1743.49 2018-06-19, BUY CREATE, 284.00 2018-06-19, Cash: 63765.98750000001 2018-06-19, Price: 284.0 2018-06-19, Buy prop size: 222 2018-06-19, Afforded size: 222 2018-06-19, Final size: 222 2018-06-20, BUY EXECUTED, Price: 284.00, Cost: 63048.00, Comm 472.86 2018-06-20, SELL CREATE, 270.00 2018-06-21, SELL EXECUTED, Price: 270.00, Cost: 63048.00, Comm 449.55 2018-06-21, OPERATION PROFIT, GROSS -3108.00, NET -4030.41 2018-07-27, BUY CREATE, 266.00 2018-07-27, Cash: 59735.57750000001 2018-07-27, Price: 266.0 2018-07-27, Buy prop size: 222 2018-07-27, Afforded size: 222 2018-07-27, Final size: 222 2018-07-30, BUY EXECUTED, Price: 266.00, Cost: 59052.00, Comm 442.89 2018-09-06, SELL CREATE, 281.00 2018-09-07, SELL EXECUTED, Price: 281.00, Cost: 59052.00, Comm 467.87 2018-09-07, OPERATION PROFIT, GROSS 3330.00, NET 2419.24 2018-09-07, BUY CREATE, 281.00 2018-09-07, Cash: 62154.82250000001 2018-09-07, Price: 281.0 2018-09-07, Buy prop size: 219 2018-09-07, Afforded size: 219 2018-09-07, Final size: 219 2018-09-10, BUY EXECUTED, Price: 281.00, Cost: 61539.00, Comm 461.54 2018-09-11, SELL CREATE, 269.00 2018-09-12, SELL EXECUTED, Price: 269.00, Cost: 61539.00, Comm 441.83 2018-09-12, OPERATION PROFIT, GROSS -2628.00, NET -3531.38 2018-10-19, BUY CREATE, 265.00 2018-10-19, Cash: 58623.44750000001 2018-10-19, Price: 265.0 2018-10-19, Buy prop size: 219 2018-10-19, Afforded size: 219 2018-10-19, Final size: 219 2018-10-22, BUY EXECUTED, Price: 265.00, Cost: 58035.00, Comm 435.26 Final Portfolio Value: 64057.39 . %matplotlib backtest(&#39;smac&#39;, jfc, fast_period=30, slow_period=50) . Using matplotlib backend: MacOSX Starting Portfolio Value: 100000.00 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 30 slow_period : 50 2018-08-23, BUY CREATE, 293.00 2018-08-23, Cash: 100000.0 2018-08-23, Price: 293.0 2018-08-23, Buy prop size: 338 2018-08-23, Afforded size: 338 2018-08-23, Final size: 338 2018-08-24, BUY EXECUTED, Price: 293.00, Cost: 99034.00, Comm 742.75 2018-10-05, SELL CREATE, 243.00 2018-10-08, SELL EXECUTED, Price: 243.00, Cost: 99034.00, Comm 616.00 2018-10-08, OPERATION PROFIT, GROSS -16900.00, NET -18258.76 2018-11-19, BUY CREATE, 282.00 2018-11-19, Cash: 81741.23999999999 2018-11-19, Price: 282.0 2018-11-19, Buy prop size: 287 2018-11-19, Afforded size: 287 2018-11-19, Final size: 287 2018-11-20, BUY EXECUTED, Price: 282.00, Cost: 80934.00, Comm 607.00 Final Portfolio Value: 83946.83 . We can conclude that across all the parameter combinations we&#39;ve tried, the best performing one is the one where fast_period = 15, while slow_period = 40. . %matplotlib backtest(&#39;smac&#39;, jfc, fast_period=15, slow_period=40) . Using matplotlib backend: MacOSX Starting Portfolio Value: 100000.00 ===Global level arguments=== init_cash : 100000 buy_prop : 1 sell_prop : 1 ===Strategy level arguments=== fast_period : 15 slow_period : 40 2018-08-07, BUY CREATE, 270.00 2018-08-07, Cash: 100000.0 2018-08-07, Price: 270.0 2018-08-07, Buy prop size: 367 2018-08-07, Afforded size: 367 2018-08-07, Final size: 367 2018-08-08, BUY EXECUTED, Price: 270.00, Cost: 99090.00, Comm 743.17 2018-09-21, SELL CREATE, 271.00 2018-09-24, SELL EXECUTED, Price: 271.00, Cost: 99090.00, Comm 745.93 2018-09-24, OPERATION PROFIT, GROSS 367.00, NET -1122.10 2018-11-05, BUY CREATE, 280.00 2018-11-05, Cash: 98877.89749999999 2018-11-05, Price: 280.0 2018-11-05, Buy prop size: 350 2018-11-05, Afforded size: 350 2018-11-05, Final size: 350 2018-11-06, BUY EXECUTED, Price: 280.00, Cost: 98000.00, Comm 735.00 Final Portfolio Value: 102272.90 . Relevant resources . Medium article | Backtrader repo | How to contribute more trading strategies . Checkout fastquant/strategies.py . New strategies can be added with as little as 20 lines of code (excluding docs) | Please let me know if you&#39;re intrested in contributing! :) | Happy to walk you through the process personally, still in the process of writing a tutorial | Planning to add the following TA strategies next: . SMAC [DONE] | RSI [DONE] | Bollinger Bands | Moving Average Convergence Divergence | EMAC (exponential moving average crossover) | On-Balance-Volume | Ichimoku Kinko Hyo | Average Directional Index | Parabolic Stop and Reverse (SAR) | Stochastic | For advanced DS peeps who want to go straight into ML based indicators, I also encourage you to contribute! . Next webinar - Lecture 3: Relative Strength Index (Theory + backtesting) .",
            "url": "https://enzoampil.github.io/fastquant-blog/strategies/lesson/2020/03/09/lesson2-backtest-your-trading-strategy.html",
            "relUrl": "/strategies/lesson/2020/03/09/lesson2-backtest-your-trading-strategy.html",
            "date": " • Mar 9, 2020"
        }
        
    
  
    
        ,"post7": {
            "title": "Lesson 1: Basic Stock Price Analysis on Jollibee Food Corp. (JFC)",
            "content": "fastquant lesson 1 . Introduction to fastquant . fastquant is a python package that allows you easily access stock data with as few as 2 lines of python code. . Its goal is to promote data driven investments by making quantitative analysis in finance accessible to everyone. . Objectives and strategies . 1) Raise awareness, and guide beginners to get a sufficient foundation by teaching the basics of quant analysis with lectures presented via blog posts &amp; online lectures . 2) Make quant analysis simple and easy w/ a high level python API that allows for lower level configuration for more advanced users - development of an easy to use python package to facilitate data driven investments . Top down approach to lectures and package design . We start w/ immediate usefulness and then work towards “deep” understanding later as more experience is gained. This approach will be reflected in the design of the blog posts, lectures, and the fastquant package. . Expect 1 - 2 lessons per month . medium article + notebook -&gt; webinar . Medium article + notebook takes 1-2 weeks, while webinar will take 1-2 weeks. So the pace will generally be 1-2 webinars per month. . Webinars will be recorded and posted as content on facebook/youtube. . Course Outline (Part 1) - Backtesting Classic Technical Analysis Indicators . 1. Lecture 1: Accessing PSE data in 3 lines of code 1. Accessing PSE data in 3 lines of code 2. Plotting a basic SMAC strategy 3. The idea of backtesting 2. Lecture 2: Backtest your trading strategy with 5 lines of code 3. Lecture 3: Relative Strength Index (Intro + backtesting) 4. Lecture 4: Bollinger Bands (Intro + backtesting) 5. Lecture 5: Moving Average Convergence Divergence (Intro + backtesting) 6. Lecture 6: Backtesting multiple strategies at the same time . Course Outline (Part 2) [TBD] - Building Advanced Indicators w/ Statistics &amp; Machine Learning based Approaches + other financial indicators . Setup . 1. Let&#39;s make sure everyone gets Google Colab working 2. Show github and encourage people to make an account (if they want to contribute to fastquant). 3. Please star the repo if you find it useful! :) . Installation . Installing fastquant is super simple since it&#39;s on pypi! . !pip3 install fastquant . Collecting fastquant Downloading https://files.pythonhosted.org/packages/8b/4f/392ad2117711ed868789c9fc3a183f6079b5eabcac7e286b78651f8ac8ab/fastquant-0.1.3.14-py3-none-any.whl (5.0MB) |████████████████████████████████| 5.0MB 693kB/s eta 0:00:01 Requirement already satisfied: numpy==1.18.0 in /usr/local/lib/python3.7/site-packages (from fastquant) (1.18.0) Requirement already satisfied: pre-commit in /usr/local/lib/python3.7/site-packages (from fastquant) (2.4.0) Requirement already satisfied: pandas==1.0.3 in /usr/local/lib/python3.7/site-packages (from fastquant) (1.0.3) Requirement already satisfied: python-dateutil==2.8.1 in /usr/local/lib/python3.7/site-packages (from fastquant) (2.8.1) Requirement already satisfied: backtrader==1.9.75.123 in /usr/local/lib/python3.7/site-packages (from fastquant) (1.9.75.123) Requirement already satisfied: urllib3==1.25.7 in /usr/local/lib/python3.7/site-packages (from fastquant) (1.25.7) Requirement already satisfied: six==1.13.0 in /usr/local/lib/python3.7/site-packages (from fastquant) (1.13.0) Requirement already satisfied: pytz==2019.3 in /usr/local/lib/python3.7/site-packages (from fastquant) (2019.3) Requirement already satisfied: black==19.10b0 in /usr/local/lib/python3.7/site-packages (from fastquant) (19.10b0) Requirement already satisfied: oauthlib==3.1.0 in /usr/local/lib/python3.7/site-packages (from fastquant) (3.1.0) Requirement already satisfied: chardet==3.0.4 in /usr/local/lib/python3.7/site-packages (from fastquant) (3.0.4) Requirement already satisfied: matplotlib==3.1.2 in /usr/local/lib/python3.7/site-packages (from fastquant) (3.1.2) Requirement already satisfied: lxml==4.4.2 in /usr/local/lib/python3.7/site-packages (from fastquant) (4.4.2) Requirement already satisfied: tqdm==4.28.1 in /usr/local/lib/python3.7/site-packages (from fastquant) (4.28.1) Requirement already satisfied: requests-oauthlib==1.3.0 in /usr/local/lib/python3.7/site-packages (from fastquant) (1.3.0) Requirement already satisfied: idna==2.8 in /usr/local/lib/python3.7/site-packages (from fastquant) (2.8) Requirement already satisfied: yfinance==0.1.54 in /usr/local/lib/python3.7/site-packages (from fastquant) (0.1.54) Requirement already satisfied: beautifulsoup4==4.8.2 in /usr/local/lib/python3.7/site-packages (from fastquant) (4.8.2) Requirement already satisfied: PySocks==1.7.1 in /usr/local/lib/python3.7/site-packages (from fastquant) (1.7.1) Requirement already satisfied: certifi==2019.11.28 in /usr/local/lib/python3.7/site-packages (from fastquant) (2019.11.28) Requirement already satisfied: bs4==0.0.1 in /usr/local/lib/python3.7/site-packages (from fastquant) (0.0.1) Requirement already satisfied: soupsieve==1.9.5 in /usr/local/lib/python3.7/site-packages (from fastquant) (1.9.5) Requirement already satisfied: tweepy==3.8.0 in /usr/local/lib/python3.7/site-packages (from fastquant) (3.8.0) Requirement already satisfied: networkx==2.4 in /usr/local/lib/python3.7/site-packages (from fastquant) (2.4) Requirement already satisfied: requests==2.22.0 in /usr/local/lib/python3.7/site-packages (from fastquant) (2.22.0) Requirement already satisfied: identify&gt;=1.0.0 in /usr/local/lib/python3.7/site-packages (from pre-commit-&gt;fastquant) (1.4.18) Requirement already satisfied: nodeenv&gt;=0.11.1 in /usr/local/lib/python3.7/site-packages (from pre-commit-&gt;fastquant) (1.3.5) Requirement already satisfied: pyyaml&gt;=5.1 in /usr/local/lib/python3.7/site-packages (from pre-commit-&gt;fastquant) (5.3.1) Requirement already satisfied: virtualenv&gt;=20.0.8 in /usr/local/lib/python3.7/site-packages (from pre-commit-&gt;fastquant) (20.0.21) Requirement already satisfied: cfgv&gt;=2.0.0 in /usr/local/lib/python3.7/site-packages (from pre-commit-&gt;fastquant) (3.1.0) Requirement already satisfied: importlib-metadata; python_version &lt; &#34;3.8&#34; in /usr/local/lib/python3.7/site-packages (from pre-commit-&gt;fastquant) (1.6.0) Requirement already satisfied: toml in /usr/local/lib/python3.7/site-packages (from pre-commit-&gt;fastquant) (0.10.1) Requirement already satisfied: appdirs in /usr/local/lib/python3.7/site-packages (from black==19.10b0-&gt;fastquant) (1.4.4) Requirement already satisfied: regex in /usr/local/lib/python3.7/site-packages (from black==19.10b0-&gt;fastquant) (2020.5.14) Requirement already satisfied: click&gt;=6.5 in /usr/local/lib/python3.7/site-packages (from black==19.10b0-&gt;fastquant) (7.1.2) Requirement already satisfied: attrs&gt;=18.1.0 in /usr/local/lib/python3.7/site-packages (from black==19.10b0-&gt;fastquant) (19.3.0) Requirement already satisfied: typed-ast&gt;=1.4.0 in /usr/local/lib/python3.7/site-packages (from black==19.10b0-&gt;fastquant) (1.4.1) Requirement already satisfied: pathspec&lt;1,&gt;=0.6 in /usr/local/lib/python3.7/site-packages (from black==19.10b0-&gt;fastquant) (0.8.0) Requirement already satisfied: cycler&gt;=0.10 in /usr/local/lib/python3.7/site-packages (from matplotlib==3.1.2-&gt;fastquant) (0.10.0) Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,&gt;=2.0.1 in /usr/local/lib/python3.7/site-packages (from matplotlib==3.1.2-&gt;fastquant) (2.4.7) Requirement already satisfied: kiwisolver&gt;=1.0.1 in /usr/local/lib/python3.7/site-packages (from matplotlib==3.1.2-&gt;fastquant) (1.2.0) Requirement already satisfied: multitasking&gt;=0.0.7 in /usr/local/lib/python3.7/site-packages (from yfinance==0.1.54-&gt;fastquant) (0.0.9) Requirement already satisfied: decorator&gt;=4.3.0 in /usr/local/lib/python3.7/site-packages (from networkx==2.4-&gt;fastquant) (4.4.2) Requirement already satisfied: distlib&lt;1,&gt;=0.3.0 in /usr/local/lib/python3.7/site-packages (from virtualenv&gt;=20.0.8-&gt;pre-commit-&gt;fastquant) (0.3.0) Requirement already satisfied: filelock&lt;4,&gt;=3.0.0 in /usr/local/lib/python3.7/site-packages (from virtualenv&gt;=20.0.8-&gt;pre-commit-&gt;fastquant) (3.0.12) Requirement already satisfied: zipp&gt;=0.5 in /usr/local/lib/python3.7/site-packages (from importlib-metadata; python_version &lt; &#34;3.8&#34;-&gt;pre-commit-&gt;fastquant) (3.1.0) Installing collected packages: fastquant Successfully installed fastquant-0.1.3.14 . Get stock data from stock in 2 lines of code! . Here I demonstrate how to get the stock data of Jollibee (JFC is the stock symbol) from January 1, 2018 to January 1, 2019. . Please ensure that your date strings are in the format YYYY-MM-DD. . You can find a list of company names and PSE stock symbols here, and Yahoo Finance symbols here . from fastquant import get_stock_data df = get_stock_data(&#39;JFC&#39;, &#39;2018-01-01&#39;, &#39;2019-01-01&#39;) df.head() . close . dt . 2018-01-03 255.4 | . 2018-01-04 255.0 | . 2018-01-05 255.0 | . 2018-01-08 256.0 | . 2018-01-09 255.8 | . help(get_stock_data) . Help on function get_stock_data in module fastquant.fastquant: get_stock_data(symbol, start_date, end_date, source=&#39;phisix&#39;, format=&#39;c&#39;) Returns pricing data for a specified stock and source. Parameters - symbol : str Symbol of the stock in the PSE or Yahoo. You can refer to these links: PHISIX: https://www.pesobility.com/stock YAHOO: https://www.nasdaq.com/market-activity/stocks/screener?exchange=nasdaq start_date : str Starting date (YYYY-MM-DD) of the period that you want to get data on end_date : str Ending date (YYYY-MM-DD) of the period you want to get data on source : str First source to query from (&#34;pse&#34;, &#34;yahoo&#34;). If the stock is not found in the first source, the query is run on the other source. format : str Format of the output data Returns - pandas.DataFrame Stock data (in the specified `format`) for the specified company and date range . Plot daily closing prices . For this part, we&#39;ll want to import a plotting package, matplotlib, to be able to visualize the closing prices of Jollibee. Don&#39;t worry if you don&#39;t understand how this works - for now, just take the code as is. . from matplotlib import pyplot as plt df.close.plot(figsize=(10, 6)) plt.title(&quot;Daily Closing Prices of JFC nfrom 2018-01-01 to 2019-01-01&quot;, fontsize=20) . Text(0.5, 1.0, &#39;Daily Closing Prices of JFC nfrom 2018-01-01 to 2019-01-01&#39;) . Analyze with a simple moving average crossover (SMAC) trading strategy . Now that we have the data ready, let&#39;s visualize a sample SMAC strategy. . First, let&#39;s import the pandas library (general purpose library for handling tabular data). . import pandas as pd . Next, we calculate the 30 day moving average of Jollibee&#39;s closing price and combine it with the original closing price data. . ma30 = df.close.rolling(30).mean() close_ma30 = pd.concat([df.close, ma30], axis=1).dropna() close_ma30.columns = [&#39;Closing Price&#39;, &#39;Simple Moving Average (30 day)&#39;] . ma30.dropna() . dt 2018-02-13 276.586667 2018-02-14 277.340000 2018-02-15 278.340000 2018-02-19 279.340000 2018-02-20 280.340000 ... 2018-12-20 287.446667 2018-12-21 288.193333 2018-12-26 288.660000 2018-12-27 289.360000 2018-12-28 289.993333 Name: close, Length: 214, dtype: float64 . ma30.dropna().plot(figsize=(10, 6)) . &lt;matplotlib.axes._subplots.AxesSubplot at 0x114e25890&gt; . Lastly, we plot the trends for the daily closing prices and the 30 day SMA together . close_ma30.plot(figsize=(10, 6)) plt.title(&quot;Daily Closing Prices vs 30 day SMA of JFC nfrom 2018-01-01 to 2019-01-01&quot;, fontsize=20) . Text(0.5, 1.0, &#39;Daily Closing Prices vs 30 day SMA of JFC nfrom 2018-01-01 to 2019-01-01&#39;) . Relevant resources . Access Philippine Stock Data with Only 2 Lines of Python | Technical analysis basics from investopedia | My Learning Plan for Getting Into Data Science from Scratch | Thank you! .",
            "url": "https://enzoampil.github.io/fastquant-blog/data/lesson/2020/01/26/lesson1-accessing-pse_data.html",
            "relUrl": "/data/lesson/2020/01/26/lesson1-accessing-pse_data.html",
            "date": " • Jan 26, 2020"
        }
        
    
  

  
  

  
      ,"page1": {
          "title": "About fastquant",
          "content": "Mission . To give everyone the ability to make data driven investment decisions. . Objectives . 1) Raise awareness, and guide beginners to get a sufficient foundation by teaching the basics of quant analysis with lessons &amp; tutorials presented via blog posts &amp; online lectures . 2) Make quant analysis simple and easy w/ a high level python API that allows for lower level configuration for more advanced users - development of an easy to use python package to facilitate data driven investments .",
          "url": "https://enzoampil.github.io/fastquant-blog/about/",
          "relUrl": "/about/",
          "date": ""
      }
      
  

  

  
  

  

  
  

  

  
  

  
  

  
  

  
      ,"page10": {
          "title": "",
          "content": "Sitemap: {{ “sitemap.xml” | absolute_url }} | .",
          "url": "https://enzoampil.github.io/fastquant-blog/robots.txt",
          "relUrl": "/robots.txt",
          "date": ""
      }
      
  

}